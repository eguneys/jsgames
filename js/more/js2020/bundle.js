var Tetris=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){const s=i(2);t.exports=s.app},function(t,e,i){"use strict";function s(t){const e=document.createElement("canvas");let i=this.ctx=e.getContext("2d");e.width=this.width=320,e.height=this.height=180,t.appendChild(e),n(t,e,i),window.addEventListener("resize",()=>{n(t,e,i)})}function n(t,e,i){const s=t.getBoundingClientRect();let n=s.width,a=n/(16/9);s.height<a&&(a=s.height,n=a*(16/9)),e.style.width=n+"px",e.style.height=a+"px",i.imageSmoothingEnabled=!1}function a(t,e){let i=t.ctx,s=0,n=0;this.fill=t=>{i.fillStyle=t},this.clear=()=>{i.clearRect(0,0,320,180)},this.fr=(t,e,s,n)=>{i.fillRect(t,e,s,n)},this.camera=(t=0,e=0)=>{s=t,n=e},this.sspr=(t,a,r,h,l,o,d=r,c=h,u=!1)=>{l=Math.floor(l-s),o=Math.floor(o-n),u&&(i.scale(-1,1),l*=-1,l-=d),i.drawImage(e,t,a,r,h,l,o,d,c),i.setTransform(1,0,0,1,0,0)}}function r(t){this.start=e=>{let i=new Image;i.onload=()=>{e(i)},i.src=t}}function h(t){function e(){t(),requestAnimationFrame(e)}this.start=()=>{e()}}i.r(e),i.d(e,"app",(function(){return S}));const l=(t,e,i)=>t<e?Math.min(t+i,e):t>e?Math.max(t-i,e):e,o=(t,e,i)=>t<e?e:t>i?i:t;var d=[[-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,117,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,-1,20,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,33,33,33,33,33,33,33,33,33,33,34,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,49,49,49,-1,97,-1,-1,-1,-1,-1,-1,50,-1,-1,48,-1,-1,-1,-1,-1,32,34,-1,-1,-1,-1,-1,24,-1,-1,-1,48,49,49,-1,-1,-1,-1,-1,-1,-1,-1,-1,50,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,-1,-1,-1,48,49,-1,-1,-1,-1,-1,-1,20,20,-1,-1,50,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,50,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,50,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,34,-1,-1,-1,-1,50,-1,-1,32,33,33,33,33,33,33,33,33,33,33,33,33,33,-1,-1,-1,-1,-1,20,32,33,49,49,49,-1,-1,-1,-1,50,-1,-1,48,49,49,49,49,49,49,49,49,49,49,49,49,49,-1,-1,20,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,50,-1,-1,48,49,49,49,49,49,49,49,49,49,49,49,49,49,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,50,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,50,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,33,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,32,33,34,-1,-1,-1,-1,-1,-1,-1,20,20,20,20,20,20,20,32,33,33,33,33,33,33,33,33,33,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,49,49,49,49,49,49,49,49,49,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,49,49,49,49,49,49,49,49,49,-1,-1,32,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,130,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,-1,-1,33,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,34,-1,-1,32,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,33,33,33,33,33,33,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,49,49,49,49,49,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[113,-1,-1,-1,-1,-1,-1,-1,53,40,40,-1,-1,40,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,-1,-1,-1,-1,40,35,36,36,36,36,-1,-1,-1,-1,-1,35,37,20,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,36,36,36,36,36,36,36,36,36,36,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,35,36,36,36,36,36,36,37,52,52,52,52,52,52,52,52,52,52,52,52,-1,-1,-1,-1,-1,-1,-1,-1,53,40,-1,-1,51,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,-1,-1,-1,-1,-1,-1,-1,20,53,-1,-1,-1,51,52,52,52,-1,-1,-1,-1,-1,-1,40,40,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,53,-1,-1,-1,51,52,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,53,-1,-1,-1,51,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,36,-1,-1,20,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,53,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,40,40,40,-1,-1,-1,-1,40,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,20,-1,53,-1,-1,20,35,36,36,37,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,97,-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,40,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,-1,-1,-1,-1,53,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,53,-1,24,-1,-1,-1,-1,36,-1,-1,-1,-1,36,-1,-1,-1,20,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,53,35,37,-1,-1,-1,-1,52,-1,-1,-1,-1,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,35,36,37,40,37,-1,-1,52,52,52,-1,-1,-1,-1,52,-1,-1,-1,-1,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,52,52,52,53,-1,-1,-1,52,52,52,-1,-1,-1,-1,52,-1,-1,-1,-1,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,52,52,52,53,-1,-1,35,52,52,52,-1,-1,-1,-1,52,-1,-1,-1,-1,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,52,52,52,53,-1,-1,51,52,52,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,-1,53,-1,-1,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,-1,-1,-1,-1,-1,-1,-1,-1,-1,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,40,40,-1,-1,-1,-1,-1,40,-1,51,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,40,-1,51,53,40,40,-1,-1,-1,-1,-1,-1,40,40,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,51,53,-1,-1,51,53,40,40,-1,35,36,36,36,37,40,40,35,36,36,37,40,40,40,35,36,36,36,36,36,37,40,40,51,53,-1,-1,51,53,-1,-1,-1,51,52,52,52,52,52,52],[40,40,40,40,-1,-1,-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,40,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,36,36,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,52,52,52,52,-1,-1,-1,38,-1,20,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,54,36,36,-1,-1,-1,35,36,37,52,52,52,52,52,52,38,-1,-1,54,-1,-1,-1,-1,54,-1,-1,-1,38,38,-1,-1,-1,-1,-1,-1,-1,-1,-1,51,52,52,52,52,52,52,52,52,38,-1,-1,54,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,64,-1,-1,-1,-1,-1,-1,-1,38,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,54,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,54,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,54,54,-1,-1,38,38,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,37,-1,-1,35,36,36,37,-1,-1,35,36,37,-1,36,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,37,37,-1,-1,-1,-1,-1,-1,-1,-1,64,-1,-1,-1,-1,-1,-1,64,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,53,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,40,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,35,36,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,36,37,-1,-1,35,36,36,37,-1,-1,35,36,37,-1,36,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,64,-1,40,40,64,-1,-1,-1,40,40,-1,64,-1,-1,-1,40,40,40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,101,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,20,20,20,-1,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,37,40,-1,20,20,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,97,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,33,33,-1,-1,36,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,33,-1,-1,-1,32,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,20,-1,-1,-1,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,33,33,33,33,33,33,33,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],c={"-1":[72,16],0:[0,0],20:[32,8],24:[64,8],32:[0,16,3],33:[8,16,3],34:[16,16,3],35:[24,16,1],36:[32,16,1],37:[40,16,1],38:[48,16],40:[64,16],48:[0,24,3],49:[8,24,3],50:[16,24,3],51:[24,24,1],52:[32,24,1],53:[40,24,1],54:[48,24],64:[0,32,1],97:[8,48],101:[40,48,1],113:[8,56],117:[40,56],130:[8,64],13:[0,40],14:[24,40]};function u(t){let e=0;this.level=t=>((t||0===t)&&(e=t),e),this.solidAt=(t,e,i,s,n=1)=>{for(let a=Math.max(0,Math.floor(t/16));a<=Math.min(31,(t+i-1)/16);a++)for(let t=Math.max(0,Math.floor(e/16));t<=Math.min(31,(e+s-1)/16);t++)if(this.fget(a,t,n))return!0;return!1},this.fget=(t,e,i)=>(c[this.mget(t,e)][2]&i)===i,this.mget=(t,i)=>d[e][32*i+t],this.draw=(e,i,s,n)=>{for(let a=0;a<s;a++)for(let s=0;s<n;s++){let n=this.mget(e+a,i+s);n&&(n=c[n],this.fget(e+a,i+s,1)&&t.sspr(n[0],n[1],8,8,16*(e+a),16*(i+s),16,16))}}}function f(t,e,i){let{g:s}=i,n=e.map,a=this.p={s:0,si:0,sj:0,flipx:!1,x:0,y:0,dx:0,dy:0,ay:0,w:16,h:16,collideable:!0,cbox:[0,0,16,16]},r=0,h=0;this.init=(t,e)=>{a.x=t,a.y=e};const l=this.absCbox=()=>{let t=a.cbox;return[a.x+t[0],a.y+t[1],t[2],t[3]]};this.isFlag=(t,e,i)=>{let s=l();return n.solidAt(s[0]+t,s[1]+e,s[2],s[3],i)};const o=this.isSolid=(i,s)=>{let a=l();return n.solidAt(a[0]+i,a[1]+s,a[2],a[3])||e.checkObject(t,g,i,s)||e.checkObject(t,w,i,s)};this.update=()=>{r+=a.dx;let t=Math.floor(r);r-=t,(t=>{let e=Math.sign(t);for(let i=0;i<Math.abs(t);i++){if(o(e,0)){a.dx=0;break}a.x+=e}})(t),h+=a.dy,t=Math.floor(h),h-=t,(t=>{let e=Math.sign(t);for(let i=0;i<Math.abs(t);i++){if(o(0,e)){a.dy=0;break}a.y+=e}})(t)},this.draw=()=>{let t=c[a.s];s.sspr(t[0]+8*a.si,t[1]+8*a.sj,8,8,a.x,a.y,a.w,a.h,a.flipx)}}function p(t,e){let i,s,n,a,{e:r,g:h}=e,d=t.cam,c=this.base=new f(this,t,e),u=this.p=c.p,p=0,w=0;let x,y;this.init=(t,e)=>{c.init(t,e),x=1,y=1,a=0,n=0,u.cbox=[2,6,10,10]},this.update=()=>{if(c.update(),u.y<=16&&u.x>496)return void t.nextLevel(this);if(u.y>=480&&u.x<0)return void t.prevLevel(this);if(u.x=o(u.x,0,496),t.checkObject(this,b,0,0)&&t.killPlayer(this),u.y>=512)return void t.killPlayer(this);let e=0,h=0,f=0;r.up?e=-1:r.down&&(e=1),r.left?h=-1:r.right&&(h=1),r.x&&(f=!i),i=r.x,f?s=8:s>0&&s--;let g=1*h;u.dx+=g,u.dx+=.25*-u.dx;let k=0;c.isSolid(-3,0)?k=-1:c.isSolid(3,0)&&(k=1);let m=c.isSolid(0,1),v=c.isFlag(0,1,2);!u.wasGrounded&&v&&Math.abs(u.pdy)>11.9&&t.killPlayer(this),m||(u.ay=1536/2304),m?n=12:n>0&&n--,s>0&&(n>0?(u.ay=1536/2304,u.dy=-8,n=0,s=0,x=.6,y=1.4):m||0===k||(u.dy=-7.2,u.dx=1*-k*8,s=0)),x=l(x,1,.03),y=l(y,1,.03),u.w=16*x,u.h=16*y;let M=0;0!==h&&c.isSolid(h,0)&&Math.sign(u.dy)>0&&(M=1),u.dy+=u.ay,u.dy+=.25*-u.dy*1.6*M,a>0?a--:m&&!u.wasGrounded&&(a=10),Math.sign(u.pdx)==Math.sign(u.dx)&&u.wasGrounded===m||t.smoke(u.x,u.y+8),u.pdy=u.dy,u.pdx=u.dx,u.wasGrounded=m,d.x=d.x+.1*(u.x-d.x),d.y=d.y+.1*(u.y-d.y),u.flipx=u.dx<-1||!(u.dx>1)&&u.flipx,a>0?(p=12,w=Math.floor(2*(1-a/10))):m?Math.abs(u.dx)>.1?(p=3,w=(w+1/4)%3):(p=0,w=(w+1/30)%3):0!==k&&u.dy>0?(p=9,w=(w+.1)%3):(p=6,w=(w+.2)%3),u.si=Math.floor(p+w)},this.draw=()=>{c.draw()}}function w(t,e){let{e:i,g:s}=e,n=this.base=new f(this,t,e),a=this.p=n.p;a.s=20;let r=0,h=0;this.init=(t,e)=>{n.init(t,e)},this.update=()=>{n.update(),0===r?(t.checkObject(this,p,0,-1)||t.checkObject(this,p,-1,0)||t.checkObject(this,p,1,0))&&(r=1,h=30):1===r?(h--,h<=0&&(r=2,h=120,a.collideable=!1)):2===r&&(h--,h<=0&&!t.checkObject(this,p,0,0)&&(r=0,a.collideable=!0)),0===r?a.si=0:1===r&&(a.si=Math.floor(3*(1-h/30)))},this.draw=()=>{2!==r&&n.draw()}}function x(t,e){let{e:i,g:s}=e,n=this.base=new f(this,t,e),a=this.p=n.p;a.s=24;let r=0;this.init=(t,e)=>{n.init(t,e)},this.update=()=>{if(n.update(),r>0)r--,r<=0&&(a.si=0);else{let e=t.collideObject(this,p,0,0);null!==e&&(a.si=2,e.p.y=a.y-4,e.p.dx*=.2,e.p.dy=-9.6,r=10)}},this.draw=()=>{n.draw()}}function b(t,e){let{e:i,g:s}=e,n=this.base=new f(this,t,e),a=this.p=n.p;a.s=40,a.sj=Math.random()<.3?1:0;this.init=(t,e)=>{a.cbox=[2,2,10,10],n.init(t,e)},this.update=()=>{n.update()},this.draw=()=>{n.draw()}}function y(t,e){let{e:i,g:s}=e,n=this.base=new f(this,t,e),a=this.p=n.p;a.s=13;let r=0;this.init=(t,e,i)=>{r=30,n.init(t,e),a.dx=.5-Math.random(),a.dy=.5-Math.random(),a.s=i?14:13},this.update=()=>{r>0&&(r--,r<=0&&t.destroyObject(this)),n.update(),a.si=Math.floor(3*(1-r/30))},this.draw=()=>{n.draw()}}function g(t,e,i){let s,n,a,{e:r,g:h}=e,l=this.base=new f(this,t,e),o=this.p=l.p;o.s=i,this.init=(t,e)=>{n=0,a=38===i?0:60,l.init(t,e)},this.update=()=>{l.update(),a++,n=a%120/120<.5?0:1,n!==s&&(0===n?(o.collideable=!1,o.si=1):t.checkObject(this,p,0,0)||(o.si=0,o.collideable=!0)),s=n},this.draw=()=>{l.draw()}}function k(t,e){e={name:"pool",warnLeak:400,...e};const i=(()=>{let t=0;return()=>t++})();let s=[],n=[];this.name=()=>e.name,this.alives=()=>s.length,this.total=()=>n.length+s.length,this.warnLeak=()=>e.warnLeak,this.toString=()=>`[${this.name()} alives: ${this.alives()} deads: ${n.length}]`,this.acquire=(e=(()=>{}))=>{let a;return this.total()>this.warnLeak()&&(console.warn(`possible pool leak at ${this.name()}.`),this.releaseLast()),a=n.length>0?n.pop():t(i()),e(a),s.push(a),a},this.acquireLimit=(t,e)=>{for(;this.alives()<e;)this.acquire(t)},this.release=t=>{this.releaseIndex(s.indexOf(t))},this.releaseIndex=t=>{t>-1&&n.push(s.splice(t,1)[0])},this.releaseLast=()=>{this.releaseIndex(0)},this.releaseAll=()=>{n=[...n,...s],s=[]},this.releaseIf=(t,e=(()=>{}))=>{let i=[],a=[];s.forEach(s=>{t(s)?(e(s),i.push(s)):a.push(s)}),s=a,n=[...i,...n]},this.reduce=(t,e)=>s.reduce(t,e),this.map=t=>s.map(t),this.flatMap=t=>s.flatMap(t),this.each=t=>{s.forEach(t)},this.find=t=>s.find(t),this.filter=t=>s.filter(t)}function m(t,e){let i=[],s=new k(()=>new p(this,e)),n=new k(()=>new w(this,e)),a=new k(()=>new x(this,e)),r=new k(()=>new b(this,e)),h=this.pSplash=new k(()=>new y(this,e));const d={0:s,20:n,24:a,40:r,38:new k(()=>new g(this,e,38)),54:new k(()=>new g(this,e,54))};let c=this.cam={x:0,y:0,shake:0,shakex:0,shakey:0};function f(t,e,s,n){let a=t.acquire(t=>t.init(e,s,n));return a._pool=t,i.push(a),a}function m(t){t._pool.release(t),i.splice(i.indexOf(t),1)}function v(t,e,s,n){let a=t.base.absCbox();a[0]+=s,a[1]+=n;for(let s of i)if(null!==s&&s instanceof e&&s!==t&&s.p.collideable){let t=s.base.absCbox();if(h=t,(r=a)[0]+r[2]>h[0]&&r[1]+r[3]>h[1]&&r[0]<h[0]+h[2]&&r[1]<h[1]+h[3])return s}var r,h;return null}function M(){c.shake=10}this.prevLevel=function(e){m(e),t.prevLevel()},this.nextLevel=function(e){m(e),t.nextLevel()},this.shake=M,this.smoke=function(t,e){f(h,t,e,1)},this.checkObject=function(t,e,i,s){return null!==v(t,e,i,s)},this.collideObject=v,this.initObject=f,this.destroyObject=m;let{g:j,e:L}=e,O=this.map=new u(j),S=0;this.init=(t=O.level())=>{O.level(t),S=0,c.shake=0,c.shakex=0,c.shakey=0;for(let t of i)t._pool.release(t);i=[];for(let t=0;t<32;t++)for(let e=0;e<32;e++){let i=O.mget(t,e);d[i]&&f(d[i],16*t,16*e)}},this.killPlayer=t=>{for(let e=0;e<4;e++)f(h,t.p.x,t.p.y);m(t),S=30,M()},this.update=()=>{S>0&&(--S,S<=0&&this.init()),c.shake>0&&(c.shake--,c.shakex=l(c.shakex,4-8*Math.random(),1+4*Math.random()),c.shakey=l(c.shakey,4-8*Math.random(),1+4*Math.random()));for(let t of i)t.update()},this.draw=()=>{let t=o(c.x-160,0,192),e=o(c.y-90,0,332);j.camera(t+c.shakex,e+c.shakey),O.draw(Math.floor(t/16),Math.floor(e/16),21,12.25);for(let t of i)t.draw()}}function v(t,e){let i,{g:s}=e;let n=0,a=0,r=0;this.off=()=>0===n,this.init=t=>{i=t,n=20,a=0,r=0},this.update=()=>{n>0&&(n--,10===n&&i()),n>10?r+=32:n<20&&(a+=32)},this.draw=()=>{s.fill("#fff1e8"),s.fr(a,0,r,180)}}function M(t,e){let{g:i,e:s}=e,n=0,a=!1,r=0,h=[[3,3],[4,2],[0,0],[0,0],[-4,4],[1,5],[0,0],[0,0]];this.update=()=>{s.p.c&&(n++,n%=h.length),s.p.x&&t.resetLevels(),s.p.right?h[n][0]++:s.p.left?h[n][0]--:s.p.up?h[n][1]--:s.p.down&&h[n][1]++,a=!0;for(let[t,e]of h)if(0!==t){a=!1;break}r>0?r--:a&&(r=60)},this.draw=()=>{r>30||(i.sspr(112,144,16,16,32*h[0][0]+0,32*h[0][1]+0,32,32),i.sspr(128,144,16,16,32*h[1][0]+32,32*h[1][1]+0,32,32),i.sspr(144,144,16,16,32*h[2][0]+64,32*h[2][1]+0,32,32),i.sspr(160,144,16,16,32*h[3][0]+128,32*h[3][1]+0,32,32),i.sspr(128,144,16,16,32*h[4][0]+160,32*h[4][1]+0,32,32),i.sspr(176,144,16,16,32*h[5][0]+192,32*h[5][1]+0,32,32),i.sspr(112,144,16,16,32*h[6][0]+224,32*h[6][1]+0,32,32),i.sspr(192,144,16,16,32*h[7][0]+256,32*h[7][1]+0,32,32))}}function j(t,e){let{e:i,g:s}=e;this.update=()=>{(i.p.x||i.p.c)&&t.beginLevels()},this.draw=()=>{}}function L(t){let e,{g:i,e:s}=t,n=new m(this,t),a=new v(this,t),r=(new M(this,t),new j(this,t));i.fill("#1d2b53");let h={current:0};this.init=()=>{e=r,this.beginLevels()},this.beginLevels=()=>{a.init(()=>{n.init(h.current),e=n})},this.nextLevel=()=>{h.current++,a.init(()=>{n.init(h.current)})},this.prevLevel=()=>{h.current--,a.init(()=>{n.init(h.current)})},this.update=()=>{a.update(),e.update()},this.draw=()=>{i.clear(),e.draw(),a.draw()}}function O(){let t=["up","left","right","down","x","c","enter"];this.p={};let e={};this.update=()=>{for(let i of t)this[i]&&!e[i]?this.p[i]=!0:this.p[i]=!1,e[i]=this[i]};const i=t=>{this[t]=!0},s=t=>{this[t]=!1},n=t=>{switch(t.code){case"ArrowUp":i("up");break;case"ArrowDown":i("down");break;case"ArrowLeft":i("left");break;case"ArrowRight":i("right");break;case"KeyX":i("x");break;case"KeyC":i("c");break;case"Enter":i("enter")}},a=t=>{switch(t.code){case"ArrowUp":s("up");break;case"ArrowDown":s("down");break;case"ArrowLeft":s("left");break;case"ArrowRight":s("right");break;case"KeyX":s("x");break;case"KeyC":s("c");break;case"Enter":s("enter")}};this.bind=()=>{document.addEventListener("keydown",n),document.addEventListener("keyup",a)}}function S(t,e){let i=new s(t),n=new O;n.bind(),new r((e.assetsBase||"assets")+"/sprites.png").start(t=>{let e=new L({g:new a(i,t),e:n});e.init(),new h(()=>{n.update(),e.update(),e.draw()}).start()})}}]);