var Tetris=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){const s=i(2);t.exports=s.app},function(t,e,i){"use strict";function s(t){const e=document.createElement("canvas");let i=this.ctx=e.getContext("2d");e.width=this.width=320,e.height=this.height=180,t.appendChild(e),n(t,e,i),window.addEventListener("resize",()=>{n(t,e,i)})}function n(t,e,i){const s=t.getBoundingClientRect();let n=s.width,a=n/(16/9);s.height<a&&(a=s.height,n=a*(16/9)),e.style.width=n+"px",e.style.height=a+"px",i.imageSmoothingEnabled=!1}function a(t,e){let i=t.ctx,s=0,n=0;this.fill=t=>{i.fillStyle=t},this.clear=()=>{i.clearRect(0,0,320,180)},this.fr=(t,e,s,n)=>{i.fillRect(t,e,s,n)},this.camera=(t=0,e=0)=>{s=t,n=e},this.sspr=(t,a,h,r,l,o,c=h,d=r,u=!1)=>{l=Math.floor(l-s),o=Math.floor(o-n),u&&(i.scale(-1,1),l*=-1,l-=c),i.drawImage(e,t,a,h,r,l,o,c,d),i.setTransform(1,0,0,1,0,0)}}function h(t){this.start=e=>{let i=new Image;i.onload=()=>{e(i)},i.src=t}}function r(t){function e(){t(),requestAnimationFrame(e)}this.start=()=>{e()}}i.r(e),i.d(e,"app",(function(){return E}));const l=(t,e,i=.1)=>t+(e-t)*i,o=(t,e,i)=>t<e?Math.min(t+i,e):t>e?Math.max(t-i,e):e,c=(t,e,i)=>t<e?e:t>i?i:t;var d=[[1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,117,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,32,33,1,20,20,1,1,1,1,1,1,1,1,1,1,1,1,32,33,33,33,33,33,33,33,33,33,33,33,34,1,1,48,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,49,49,49,1,97,1,1,1,1,1,1,50,1,1,48,1,1,1,1,1,32,34,1,1,1,1,1,24,1,1,1,48,49,49,1,1,1,1,1,1,1,1,1,50,1,1,48,1,1,1,1,1,1,1,1,1,1,1,1,33,1,1,1,48,49,1,1,1,1,1,1,20,20,1,1,50,1,1,48,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,50,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,50,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,1,1,1,32,33,34,1,1,1,1,50,1,1,32,33,33,33,33,33,33,33,33,33,33,33,33,33,1,1,1,1,1,20,32,33,49,49,49,1,1,1,1,50,1,1,48,49,49,49,49,49,49,49,49,49,49,49,49,49,1,1,20,20,1,1,1,1,1,1,1,1,1,1,1,50,1,1,48,49,49,49,49,49,49,49,49,49,49,49,49,49,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,1,1,1,1,1,33,33,34,1,1,1,1,1,1,1,1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,24,1,1,1,1,1,1,1,1,32,33,34,1,1,1,1,1,1,1,20,20,20,20,20,20,20,32,33,33,33,33,33,33,33,33,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,49,49,49,49,49,49,49,49,49,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,49,49,49,49,49,49,49,49,49,1,1,32,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,1,1,1,1,1,1,0,1,1,1,1,130,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,32,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,1,1,33,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,233,1,1,1,1,1,1,1,1,1,1,1,1,1,32,33,34,1,1,32,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,32,33,33,33,33,33,33,33,34,1,1,1,1,1,1,1,1,1,1,1,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,49,49,49,49,49,1,1,1,1,1,1,1,1,1,1,1],[113,1,1,1,1,1,1,1,53,40,40,1,1,40,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,1,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,40,1,1,1,1,40,35,36,36,36,36,1,1,1,1,1,35,37,20,53,1,1,1,1,1,1,1,1,1,1,1,35,36,36,36,36,36,36,36,36,36,36,36,1,1,1,1,1,1,1,1,53,1,1,1,35,36,36,36,36,36,36,37,52,52,52,52,52,52,52,52,52,52,52,52,1,1,1,1,1,1,1,1,53,40,1,1,51,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,1,1,1,1,1,1,1,20,53,1,1,1,51,52,52,52,1,1,1,1,1,1,40,40,40,1,1,1,1,1,1,1,1,1,1,1,24,1,1,1,53,1,1,1,51,52,52,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,53,1,1,1,51,52,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,53,1,1,1,1,1,1,1,1,1,36,1,1,1,36,1,1,20,1,1,1,20,1,1,1,1,1,1,1,1,1,20,53,1,1,1,1,1,1,1,36,1,1,40,40,40,1,1,1,1,40,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,24,1,1,1,1,1,1,1,1,1,1,1,1,1,1,229,1,1,1,1,1,1,1,20,20,1,53,1,1,20,35,36,36,37,1,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,53,1,1,1,1,1,1,97,1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,1,24,1,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,40,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,1,1,1,1,53,1,1,1,1,1,1,24,1,1,1,1,24,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,53,1,24,1,1,1,1,36,1,1,1,1,36,1,1,1,20,1,1,20,1,1,1,1,1,1,1,24,1,1,1,1,53,35,37,1,1,1,1,52,1,1,1,1,52,1,1,1,1,1,1,1,1,1,20,1,1,35,36,37,40,37,1,1,52,52,52,1,1,1,1,52,1,1,1,1,52,1,1,1,1,1,1,1,1,1,1,1,1,52,52,52,53,1,1,1,52,52,52,1,1,1,1,52,1,1,1,1,52,1,1,1,1,1,1,1,1,1,1,1,1,52,52,52,53,1,1,35,52,52,52,1,1,1,1,52,1,1,1,1,52,1,1,229,1,1,1,1,1,1,1,1,1,52,52,52,53,1,1,51,52,52,52,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,1,53,1,1,51,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,51,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,1,1,1,1,1,1,1,1,1,51,1,1,1,1,1,1,1,1,1,1,40,40,40,1,1,1,1,1,40,1,51,53,1,1,1,1,1,1,1,1,1,51,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,37,40,1,51,53,40,40,1,1,1,1,1,1,40,40,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,51,53,1,1,51,53,40,40,1,35,36,36,36,37,40,40,35,36,36,37,40,40,40,35,36,36,36,36,36,37,40,40,51,53,1,1,51,53,1,1,1,51,52,52,52,52,52,52],[40,40,40,40,1,1,1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,40,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,36,36,36,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,36,52,52,52,52,1,1,1,38,1,20,20,1,1,1,1,1,1,1,1,1,1,54,36,36,1,1,1,35,36,37,52,52,52,52,52,52,38,1,1,54,1,1,1,1,54,1,1,1,38,38,1,1,1,1,1,1,1,1,1,51,52,52,52,52,52,52,52,52,38,1,1,54,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,64,1,1,1,1,1,1,1,38,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,38,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,54,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,54,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,54,54,1,1,38,38,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,35,36,37,1,1,35,36,36,37,1,1,35,36,37,1,36,1,1,1,1,1,1,1,1,1,35,36,37,37,1,1,1,1,1,1,1,1,64,1,1,1,1,1,1,64,1,1,1,1,1,1,224,1,1,1,1,1,1,1,40,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,53,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,40,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,36,1,1,35,36,1,1,1,1,1,1,1,1,1,35,36,37,1,1,35,36,36,37,1,1,35,36,37,1,36,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,64,1,40,40,64,1,1,1,40,40,1,64,1,1,1,40,40,40,1,1,1,1,1,1,1,1,1,1,1,1,32,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,101,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,20,20,20,1,1,1,24,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,1,1,1,1,1,1,1,1,1,1,35,37,40,1,20,20,20,1,1,1,1,1,1,1,1,1,1,1,1,48,1,1,24,1,1,1,1,1,1,1,1,1,1,1,97,1,1,1,1,1,1,1,1,1,1,1,1,1,32,33,33,33,1,1,36,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,33,1,1,1,32,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,1,1,1,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,32,33,33,33,33,33,33,33,33,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],u={"-1":[72,16],0:[0,0],13:[0,40],14:[24,40],20:[32,8],24:[64,8],32:[0,16,3],33:[8,16,3],34:[16,16,3],35:[24,16,1],36:[32,16,1],37:[40,16,1],38:[48,16],40:[64,16],48:[0,24,3],49:[8,24,3],50:[16,24,3],51:[24,24,1],52:[32,24,1],53:[40,24,1],54:[48,24],64:[0,32],97:[8,48],101:[40,48],113:[8,56],117:[40,56],130:[8,64]};const f={224:[0,96],229:[32,96],233:[64,96]};function p(t){let e=0;this.level=t=>((t||0===t)&&(e=t),e),this.solidAt=(t,e,i,s,n=1)=>{for(let a=Math.max(0,Math.floor(t/16));a<=Math.min(31,(t+i-1)/16);a++)for(let t=Math.max(0,Math.floor(e/16));t<=Math.min(31,(e+s-1)/16);t++)if(this.fget(a,t,n))return!0;return!1},this.fget=(t,e,i)=>{let s=u[this.mget(t,e)];return s&&(s[2]&i)===i},this.mget=(t,i)=>d[e][32*i+t],this.draw=(e,i,s,n,a=1)=>{for(let h=0;h<s;h++)for(let s=0;s<n;s++){let n=this.mget(e+h,i+s);n&&(n=u[n],n&&this.fget(e+h,i+s,a)&&t.sspr(n[0],n[1],8,8,16*(e+h),16*(i+s),16,16))}}}function w(t,e,i){let{g:s}=i,n=e.map,a=this.p={s:0,si:0,sj:0,flipx:!1,x:0,y:0,dx:0,dy:0,ay:0,w:16,h:16,collideable:!0,cbox:[0,0,16,16]},h=0,r=0;this.init=(t,e)=>{a.x=t,a.y=e};const l=this.absCbox=()=>{let t=a.cbox;return[a.x+t[0],a.y+t[1],t[2],t[3]]};this.isFlag=(t,e,i)=>{let s=l();return n.solidAt(s[0]+t,s[1]+e,s[2],s[3],i)};const o=this.isSolid=(i,s)=>{let a=l();return n.solidAt(a[0]+i,a[1]+s,a[2],a[3])||e.checkObject(t,m,i,s)||e.checkObject(t,b,i,s)};this.update=()=>{h+=a.dx;let t=Math.floor(h);h-=t,(t=>{let e=Math.sign(t);for(let i=0;i<Math.abs(t);i++){if(o(e,0)){a.dx=0;break}a.x+=e}})(t),r+=a.dy,t=Math.floor(r),r-=t,(t=>{let e=Math.sign(t);for(let i=0;i<Math.abs(t);i++){if(o(0,e)){a.dy=0;break}a.y+=e}})(t)},this.draw=()=>{let t=u[a.s];s.sspr(t[0]+8*a.si,t[1]+8*a.sj,8,8,a.x,a.y,a.w,a.h,a.flipx)}}function x(t,e){let i,s,n,a,h,r,l,d,{e:u,g:f}=e,p=t.cam,x=this.base=new w(this,t,e),b=this.p=x.p,y=0,k=0;let m,M;this.init=(t,e)=>{x.init(t,e),h=!1,m=1,M=1,d=0,n=0,b.cbox=[2,6,10,10]},this.canCollect=()=>!h&&a,this.wasGrounded=()=>{a=!0};const v=()=>{h=!0,t.killPlayer(this)};this.update=()=>{if(x.update(),b.y<=16&&b.x>496)return void t.nextLevel(this);if(b.y>=480&&b.x<0)return void t.prevLevel(this);if(b.x=c(b.x,0,496),t.checkObject(this,g,0,0)&&v(),b.y>=512)return void v();let e=0,h=0,f=0;u.up?e=-1:u.down&&(e=1),u.left?h=-1:u.right&&(h=1),u.x&&(f=!i),i=u.x,f?s=8:s>0&&s--;let w=1*h;b.dx+=w,b.dx+=.25*-b.dx;let j=0;x.isSolid(-3,0)?j=-1:x.isSolid(3,0)&&(j=1);let O=x.isSolid(0,1),L=x.isFlag(0,1,2);!a&&L&&Math.abs(l)>11.9&&v(),O||(b.ay=1536/2304),O?n=12:n>0&&n--,s>0&&(n>0?(b.ay=1536/2304,b.dy=-8,n=0,s=0,m=.6,M=1.4):O||0===j||(b.dy=-7.2,b.dx=1*-j*8,s=0)),m=o(m,1,.03),M=o(M,1,.03),b.w=16*m,b.h=16*M;let S=0;0!==h&&x.isSolid(h,0)&&Math.sign(b.dy)>0&&(S=1),b.dy+=b.ay,b.dy+=.25*-b.dy*1.6*S,d>0?d--:O&&!a&&(d=10),Math.sign(r)==Math.sign(b.dx)&&a===O||t.smoke(b.x,b.y+8),l=b.dy,r=b.dx,a=O,p.x=p.x+.1*(b.x-p.x),p.y=p.y+.1*(b.y-p.y),b.flipx=b.dx<-1||!(b.dx>1)&&b.flipx,d>0?(y=12,k=Math.floor(2*(1-d/10))):O?Math.abs(b.dx)>.1?(y=3,k=(k+1/4)%3):(y=0,k=(k+1/30)%3):0!==j&&b.dy>0?(y=9,k=(k+.1)%3):(y=6,k=(k+.2)%3),b.si=Math.floor(y+k)},this.draw=()=>{x.draw()}}function b(t,e){let{e:i,g:s}=e,n=this.base=new w(this,t,e),a=this.p=n.p;a.s=20;let h=0,r=0;this.init=(t,e)=>{n.init(t,e)},this.update=()=>{n.update(),0===h?(t.checkObject(this,x,0,-1)||t.checkObject(this,x,-1,0)||t.checkObject(this,x,1,0))&&(h=1,r=30):1===h?(r--,r<=0&&(h=2,r=120,a.collideable=!1)):2===h&&(r--,r<=0&&!t.checkObject(this,x,0,0)&&(h=0,a.collideable=!0)),0===h?a.si=0:1===h&&(a.si=Math.floor(3*(1-r/30)))},this.draw=()=>{2!==h&&n.draw()}}function y(t,e){let{e:i,g:s}=e,n=this.base=new w(this,t,e),a=this.p=n.p;a.s=24;let h=0;this.init=(t,e)=>{n.init(t,e)},this.update=()=>{if(n.update(),h>0)h--,h<=0&&(a.si=0);else{let e=t.collideObject(this,x,0,0);null!==e&&(a.si=2,e.p.y=a.y-4,e.p.dx*=.2,e.p.dy=-9.6,e.wasGrounded(),h=10)}},this.draw=()=>{n.draw()}}function g(t,e){let{e:i,g:s}=e,n=this.base=new w(this,t,e),a=this.p=n.p;a.s=40,a.sj=Math.random()<.3?1:0;this.init=(t,e)=>{a.cbox=[2,2,10,10],n.init(t,e)},this.update=()=>{n.update()},this.draw=()=>{n.draw()}}function k(t,e){let{e:i,g:s}=e,n=this.base=new w(this,t,e),a=this.p=n.p;a.s=13;let h=0;this.init=(t,e,i)=>{h=30,n.init(t,e),a.dx=.5-Math.random(),a.dy=.5-Math.random(),a.s=i?14:13},this.update=()=>{h>0&&(h--,h<=0&&t.destroyObject(this)),n.update(),a.si=Math.floor(3*(1-h/30))},this.draw=()=>{n.draw()}}function m(t,e,i){let s,n,a,{e:h,g:r}=e,l=this.base=new w(this,t,e),o=this.p=l.p;o.s=i,this.init=(t,e)=>{n=0,a=38===i?0:60,l.init(t,e)},this.update=()=>{l.update(),a++,n=a%120/120<.5?0:1,n!==s&&(0===n?(o.collideable=!1,o.si=1):t.checkObject(this,x,0,0)||(o.si=0,o.collideable=!0)),s=n},this.draw=()=>{l.draw()}}function M(t,e,i,s){let n,a,h,r,o,{e:c,g:d}=e,u=this.base=new w(this,t,e),f=this.p=u.p;f.s=i,this.init=(t,e)=>{u.init(t,e),o=0,r=null,h=0,n=t,a=e,this.info=[s,n,a]},this.update=()=>{if(u.update(),h++,f.y=a+4*Math.sin(h%60/60*Math.PI*2),r)f.x=l(f.x,r.p.x,.2),a=l(a,r.p.y-16,.2),r.canCollect()&&(r=null,o=30);else{let e=t.collideObject(this,x,0,0);null!==e&&(r=e)}o>0&&(o--,o<=0&&t.collect404(this)),f.si=0===o&&h%60<30?Math.floor(h%30/30*3):0},this.draw=()=>{(0===o||o%10<5)&&u.draw()}}function v(t,e){let i,{e:s,g:n}=e,a=this.base=new w(this,t,e),h=this.p=a.p;h.s=64,this.init=(t,e)=>{a.init(t,e),i=-1,h.dx=-1},this.update=()=>{a.update(),h.dx<0&&!a.isSolid(-16,-1)?h.dx*=-1:a.isSolid(16,-1)||(h.dx*=-1)},this.draw=()=>{a.draw()}}function j(t,e){let i=[],s=[];this.acquire=(e=(()=>{}))=>{let n;return n=s.length>0?s.pop():t(),e(n),i.push(n),n},this.release=t=>{n(i.indexOf(t))};const n=t=>{t>-1&&s.push(i.splice(t,1)[0])};this.releaseAll=()=>{s=[...s,...i],i=[]}}function O(t,e){let i=[],s=new j(()=>new x(this,e)),n=new j(()=>new b(this,e)),a=new j(()=>new y(this,e)),h=new j(()=>new g(this,e)),r=this.pSplash=new j(()=>new k(this,e)),l=new j(()=>new m(this,e,38)),d=new j(()=>new m(this,e,54)),u=new j(()=>new M(this,e,130,2)),w=new j(()=>new M(this,e,113,3)),O=new j(()=>new M(this,e,117,4)),L=new j(()=>new M(this,e,101,5));const S={0:s,20:n,24:a,40:h,38:l,54:d,97:new j(()=>new M(this,e,97,0)),101:L,113:w,117:O,130:u,64:new j(()=>new v(this,e))};let A=this.cam={x:0,y:0,shake:0,shakex:0,shakey:0},C=[];function _(t,e,s,n){let a=t.acquire(t=>t.init(e,s,n));return a._pool=t,i.push(a),a}function E(t){t._pool.release(t),i.splice(i.indexOf(t),1)}function P(t,e,s,n){let a=t.base.absCbox();a[0]+=s,a[1]+=n;for(let s of i)if(null!==s&&s instanceof e&&s!==t&&s.p.collideable){let t=s.base.absCbox();if(r=t,(h=a)[0]+h[2]>r[0]&&h[1]+h[3]>r[1]&&h[0]<r[0]+r[2]&&h[1]<r[1]+r[3])return s}var h,r;return null}function R(){A.shake=10}this.collect404=function(e){t.collect(e.info)},this.prevLevel=function(e){E(e),t.prevLevel()},this.nextLevel=function(e){E(e),t.nextLevel()},this.shake=R,this.smoke=function(t,e){_(r,t,e,1)},this.checkObject=function(t,e,i,s){return null!==P(t,e,i,s)},this.collideObject=P,this.initObject=_,this.destroyObject=E;let{g:K,e:T}=e,q=this.map=new p(K),F=0;this.init=(t=q.level())=>{q.level(t),F=0,A.shake=0,A.shakex=0,A.shakey=0;for(let t of i)t._pool.release(t);i=[],C=[];for(let t=0;t<32;t++)for(let i=0;i<32;i++){let a=q.mget(t,i);S[a]?_(S[a],16*t,16*i):f[a]&&(e=f[a],s=16*t,n=16*i,C.push({decal:e,x:s,y:n}))}var e,s,n},this.killPlayer=t=>{for(let e=0;e<4;e++)_(r,t.p.x,t.p.y);E(t),F=30,R()},this.update=()=>{F>0&&(--F,F<=0&&this.init()),A.shake>0&&(A.shake--,A.shakex=o(A.shakex,4-8*Math.random(),1+4*Math.random()),A.shakey=o(A.shakey,4-8*Math.random(),1+4*Math.random()));for(let t of i)t.update()},this.draw=()=>{let t=c(A.x-160,0,192),e=c(A.y-90,0,332);K.camera(t+A.shakex,e+A.shakey),C.forEach(({decal:t,x:e,y:i})=>{K.sspr(t[0],t[1],32,32,e,i,64,64)}),q.draw(Math.floor(t/16),Math.floor(e/16),21,12.25);for(let t of i)t.draw()}}function L(t,e){let i,{g:s}=e;let n=0,a=0,h=0;this.off=()=>0===n,this.init=t=>{i=t,n=20,a=0,h=0},this.update=()=>{n>0&&(n--,10===n&&i()),n>10?h+=32:n<20&&(a+=32)},this.draw=()=>{s.fill("#fff1e8"),s.fr(a,0,h,180)}}function S(t,e){let{g:i,e:s}=e;this.update=()=>{},this.draw=()=>{}}function A(t,e){let{e:i,g:s}=e;this.update=()=>{(i.p.x||i.p.c)&&t.beginLevels()},this.draw=()=>{}}function C(t){let e,{g:i,e:s}=t,n=new O(this,t),a=new L(this,t),h=(new S(this,t),new A(this,t));i.fill("#1d2b53");let r={current:0};this.init=()=>{e=h,this.beginLevels()},this.beginLevels=()=>{a.init(()=>{n.init(r.current),e=n})},this.nextLevel=()=>{r.current++,a.init(()=>{n.init(r.current)})},this.prevLevel=()=>{r.current--,a.init(()=>{n.init(r.current)})},this.collect=t=>{console.log(t)},this.update=()=>{a.update(),e.update()},this.draw=()=>{i.clear(),e.draw(),a.draw()}}function _(){let t=["up","left","right","down","x","c","enter"];this.p={};let e={};this.update=()=>{for(let i of t)this[i]&&!e[i]?this.p[i]=!0:this.p[i]=!1,e[i]=this[i]};const i=t=>{this[t]=!0},s=t=>{this[t]=!1},n=t=>{switch(t.code){case"ArrowUp":i("up");break;case"ArrowDown":i("down");break;case"ArrowLeft":i("left");break;case"ArrowRight":i("right");break;case"KeyX":i("x");break;case"KeyC":i("c");break;case"Enter":i("enter")}},a=t=>{switch(t.code){case"ArrowUp":s("up");break;case"ArrowDown":s("down");break;case"ArrowLeft":s("left");break;case"ArrowRight":s("right");break;case"KeyX":s("x");break;case"KeyC":s("c");break;case"Enter":s("enter")}};this.bind=()=>{document.addEventListener("keydown",n),document.addEventListener("keyup",a)}}function E(t,e){let i=new s(t),n=new _;n.bind(),new h((e.assetsBase||"assets")+"/sprites.png").start(t=>{let e=new C({g:new a(i,t),e:n});e.init(),new r(()=>{n.update(),e.update(),e.draw()}).start()})}}]);