var kcapeW;(()=>{"use strict";var t={86:(t,e,i)=>{t.exports=i.p+"3e53d8ff365997a17f1b.png"}},e={};function i(n){var S=e[n];if(void 0!==S)return S.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})();var n={};(()=>{i.r(n),i.d(n,{default:()=>ot});var t=i(86);const e=function(){function t(t,e){this.ctx=t,this.image=e,this.ctx.imageSmoothingEnabled=!1}return t.prototype.cls=function(){this.ctx.clearRect(0,0,320,160)},t.prototype.camera=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),t=Math.floor(t),e=Math.floor(e),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.translate(t,e)},t.prototype.style=function(t){this.ctx.fillStyle=t},t.prototype.strokeStyle=function(t){this.ctx.strokeStyle=t},t.prototype.stroke=function(t,e,i,n){t=Math.floor(t),e=Math.floor(e),this.ctx.strokeRect(t,e,i,n)},t.prototype.rect=function(t,e,i,n){this.ctx.fillRect(t,e,i,n)},t.prototype.s=function(t,e,i,n,S,r,o,s,a){void 0===a&&(a=!1),S=Math.floor(S),r=Math.floor(r),this.ctx.save(),a&&(this.ctx.scale(-1,1),S*=-1,S-=o),this.ctx.drawImage(this.image,t,e,i,n,S,r,o,s),this.ctx.restore()},t}();var S;!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down",t[t.X=4]="X",t[t.C=5]="C"}(S||(S={}));var r=[S.Left,S.Right,S.Up,S.Down,S.X,S.C];const o=function(){function t(){this.inputs={},this.gamepadPressed={}}return t.prototype.btn=function(t){var e;return(null===(e=this.inputs[t])||void 0===e?void 0:e.btn)||0},t.prototype.up=function(t){var e=this.inputs[t];e&&(e.btn=-10)},t.prototype.down=function(t){var e=this.inputs[t];e?e.btn>0||(e.btn=1):this.inputs[t]={btn:1}},t.prototype.update=function(){this.updateG();for(var t=0,e=r;t<e.length;t++){var i=e[t],n=this.inputs[i];n&&0!==n.btn&&n.btn++}},t.prototype.bind=function(){var t=this;document.addEventListener("keyup",(function(e){switch(e.code){case"ArrowUp":t.up(S.Up);break;case"ArrowDown":t.up(S.Down);break;case"ArrowLeft":t.up(S.Left);break;case"ArrowRight":t.up(S.Right);break;case"KeyX":t.up(S.X);break;case"KeyC":t.up(S.C)}})),document.addEventListener("keydown",(function(e){switch(e.code){case"ArrowUp":t.down(S.Up);break;case"ArrowDown":t.down(S.Down);break;case"ArrowLeft":t.down(S.Left);break;case"ArrowRight":t.down(S.Right);break;case"KeyX":t.down(S.X);break;case"KeyC":t.down(S.C)}}))},t.prototype.upG=function(t){this.gamepadPressed[t]&&(this.gamepadPressed[t]=!1,this.up(t))},t.prototype.downG=function(t){this.gamepadPressed[t]||(this.gamepadPressed[t]=!0,this.down(t))},t.prototype.updateG=function(){var t=navigator.getGamepads()[0];t&&(1===t.axes[0]?this.downG(S.Right):-1===t.axes[0]?this.downG(S.Left):(this.upG(S.Left),this.upG(S.Right)),1===t.axes[1]?this.downG(S.Down):-1===t.axes[1]?this.downG(S.Up):(this.upG(S.Down),this.upG(S.Up)),t.buttons[2].pressed?this.downG(S.X):this.upG(S.X),t.buttons[0].pressed?this.downG(S.C):this.upG(S.C))},t.prototype.bindGamepad=function(){},t}(),s=function(t){var e=document.createElement("canvas");e.width=320,e.height=160;var i=e.getContext("2d");if(!i)throw"No 2d context";this.ctx=i,t.appendChild(e)};var a=function(){function t(t){this.context=t}return Object.defineProperty(t.prototype,"draw",{get:function(){return this.context.draw},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this.context.input},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audio",{get:function(){return this.context.audio},enumerable:!1,configurable:!0}),t}();function c(t,e,i){return e+(i-e)*t}const h=function(){function t(t,e){this.x=t,this.y=e}return Object.defineProperty(t.prototype,"i",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"j",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return[this.x,this.y].join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"neg",{get:function(){return this.scale(-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"half",{get:function(){return this.scale(.5)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalize",{get:function(){return this.scale(1/this.length)},enumerable:!1,configurable:!0}),t.prototype.sub=function(t){return this.add(t.neg)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.scale=function(e){return this.mul(new t(e,e))},t.prototype.mul=function(e){return new t(e.x*this.x,e.y*this.y)},t.prototype.ipol=function(e,i){return new t(c(e,this.x,i.x),c(e,this.y,i.y))},t.zero=new t(0,0),t.one=new t(1,1),t.make=function(e,i){return new t(e,i)},t}();var u=h.make(8,8),p=h.make(320,160).half;const f=function(){function t(t,e,i,n){this.def={x:t,y:e,w:i,h:n}}return Object.defineProperty(t.prototype,"x",{get:function(){return this.def.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.def.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.def.w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this.def.h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return(t=this.def).x+" "+t.y+" "+t.w+" "+t.h;var t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return h.make(this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return h.make(this.x+this.w/2,this.y+this.h/2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftRect",{get:function(){return new t(this.x,this.y,this.w/2,this.h/2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightRect",{get:function(){return this.leftRect.translate(this.w/2,this.h/2)},enumerable:!1,configurable:!0}),t.prototype.div=function(t,e){return this.mul(1/t,1/e)},t.prototype.mul=function(e,i){return new t(Math.floor(this.x*e),Math.floor(this.y*i),Math.ceil(this.w*e),Math.ceil(this.h*i))},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.w+e.w,this.h+e.h)},t.prototype.intersect=function(t){return!(t.left>this.right||t.right<this.left||t.top>this.bottom||t.bottom<this.top)},t.prototype.lock=function(t){var e=Math.max(this.x,t.x),i=Math.max(this.y,t.y);return e=Math.min(e,t.right-this.w),i=Math.min(i,t.bottom-this.h),this.move(e,i)},t.prototype.approach=function(t,e,i){var n=t.sub(this.xy).scale(e);return n.length>i&&(n=n.normalize.scale(i)),this.translate(n.x,n.y)},t.prototype.move=function(e,i){return this.x===e&&this.y===i?this:new t(e,i,this.w,this.h)},t.prototype.translate=function(t,e){return this.move(this.x+t,this.y+e)},t.prototype.expand=function(e,i){return 0===i&&0===e?this:new t(this.x,this.y,this.w+e,this.h+i)},t.prototype.expandCentered=function(e,i){return 0===i&&0===e?this:new t(this.x-e/2,this.y-i/2,this.w+e,this.h+i)},t.prototype.expandM=function(t,e){return this.expandCentered(this.w*t-this.w,this.h*e-this.h)},t.prototype.equal=function(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h},t.prototype.i=function(e,i){return new t(c(e,this.x,i.x),c(e,this.y,i.y),c(e,this.w,i.w),c(e,this.h,i.h))},t.zero=new t(0,0,0,0),t.fromPoints=function(e){return e.sort((function(t,e){return t.x-e.x==0?t.y-e.y:t.x-e.x})),e.reduce((function(e,i){return e===t.empty?t.make({x:i.x,y:i.y,w:1,h:1}):(e.x+e.w===i.x&&(e=e.expand(1,0)),e.y+e.h===i.y&&(e=e.expand(0,1)),e)}),t.empty)},t.fromKey=function(e){return t.make(function(t){var e=t.split(" ").map((function(t){return parseInt(t)}));return{x:e[0],y:e[1],w:e[2],h:e[3]}}(e))},t.empty=new t(0,0,0,0),t.make=function(e){return new t(e.x,e.y,e.w,e.h)},t.point=function(e){return t.fromPoints([e])},t}(),d=function(){function t(){this.data=new Map}return t.prototype.add=function(t,e){this.data.set(t.key,e)},t.prototype.checkPoint=function(t){return this.check(f.point(t))[0]},t.prototype.check=function(t){var e=[];return this.data.forEach((function(i,n){f.fromKey(n).intersect(t)&&e.push(i)})),e},t.prototype.checkAny=function(t){return this.check(t).length>0},t}(),l=function(){function t(t,e,i,n,S){this.dimExpand=h.make(1,1),this.collide=t,this.dim=e,this.hitbox=i,this.x=n,this.y=S}return Object.defineProperty(t.prototype,"sf",{get:function(){var t;return null===(t=this.sfi)||void 0===t?void 0:t[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"si",{get:function(){var t;return null===(t=this.sfi)||void 0===t?void 0:t[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ahitbox",{get:function(){return this.hitbox.translate(this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adim",{get:function(){return this.dim.translate(this.x,this.y).expandM(this.dimExpand.x,this.dimExpand.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grounded",{get:function(){this.y+=1;var t=this.collide(this.ahitbox);return this.y-=1,t},enumerable:!1,configurable:!0}),t.prototype.walled=function(t){this.x+=3*t;var e=this.collide(this.ahitbox);return this.x-=3*t,e},t.prototype.cliff=function(t){this.x+=t*this.hitbox.w/2;var e=this.grounded;return this.x-=t*this.hitbox.w/2,this.grounded&&!e},t.prototype.moveX=function(t){this.x+=t},t.prototype.moveY=function(t){this.y+=t},t.prototype.render=function(t){this.sf&&t.s(this.sf.x,this.sf.y,this.sf.w,this.sf.h,this.adim.x,this.adim.y,this.adim.w,this.adim.h)},t.prototype.debug=function(t){t.strokeStyle("green"),t.stroke(this.ahitbox.x,this.ahitbox.y,this.ahitbox.w,this.ahitbox.h)},t}(),y=function(){function t(t){this.remx=0,this.remy=0,this.dx=0,this.dy=0,this.entity=t}return Object.defineProperty(t.prototype,"sf",{get:function(){return this.entity.sf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grounded",{get:function(){return this.entity.grounded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wallGrounded",{get:function(){return this.walled(1)||this.walled(-1)},enumerable:!1,configurable:!0}),t.prototype.walled=function(t){return this.entity.walled(t)},Object.defineProperty(t.prototype,"collide",{get:function(){return this.entity.collide},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facing",{get:function(){return Math.sign(this.dx)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facingLeft",{get:function(){return-1===this.facing},enumerable:!1,configurable:!0}),t.prototype.move=function(){this.remx+=this.dx;var t=Math.floor(this.remx);this.remx-=t,this.moveX(t),this.remy+=this.dy;var e=Math.floor(this.remy);this.remy-=e,this.moveY(e)},t.prototype.moveX=function(t){for(var e=Math.sign(t),i=0;i<Math.abs(t);i++)if(this.entity.moveX(e),this.collide(this.entity.ahitbox))return this.dx=0,void this.entity.moveX(-1*e)},t.prototype.moveY=function(t){for(var e=Math.sign(t),i=0;i<Math.abs(t);i++)if(this.entity.moveY(e),this.collide(this.entity.ahitbox))return this.dy=0,void this.entity.moveY(-1*e)},t.prototype.render=function(t){this.entity.sf&&this.entity.si&&t.s(this.entity.sf.x+this.entity.si.x*this.entity.sf.w,this.entity.sf.y+this.entity.si.y*this.entity.sf.h,this.entity.sf.w,this.entity.sf.h,this.entity.adim.x,this.entity.adim.y,this.entity.adim.w,this.entity.adim.h,this.facingLeft)},t}();var m,b=30,g=20,x=(m=function(t,e){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});const v=function(t){function e(e,i){var n=t.call(this,e)||this;return n.dynamic=i,n}return x(e,t),Object.defineProperty(e.prototype,"dx",{get:function(){return this.dynamic.dx},set:function(t){this.dynamic.dx=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dy",{get:function(){return this.dynamic.dy},set:function(t){this.dynamic.dy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this.dynamic.entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ahitbox",{get:function(){return this.entity.ahitbox},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grounded",{get:function(){return this.entity.grounded},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.dynamic.move()},e}(a),w={linear:function(t){return t},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t}},k=function(){function t(t,e,i){this.i=-1,this.ticks=e,this.hooks=t,this.easing=i||w.linear}return Object.defineProperty(t.prototype,"safeTicks",{get:function(){return this.ticks||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"on",{get:function(){return this.i>=0},enumerable:!1,configurable:!0}),t.prototype.begin=function(t){var e,i;this.ticks=t||this.ticks,this.i=0,null===(i=(e=this.hooks).begin)||void 0===i||i.call(e)},t.prototype.cut=function(t){this.i>=0&&(null==t||t(),this.end())},t.prototype.end=function(){var t,e;this.i=-1,null===(e=(t=this.hooks).end)||void 0===e||e.call(t)},t.prototype.update=function(){var t,e;if(this.i>=0){this.i++;var i=this.i/(this.ticks||1);null===(e=(t=this.hooks).update)||void 0===e||e.call(t,this.easing(i),this.ticks||this.i),this.ticks&&this.i>=this.ticks&&this.end()}},t}(),O=function(){function t(t,e){for(var i in this.states=new Map,t)this.states.set(i,this.makeState(t[i]));this.current=e,this.maybeState(this.current,(function(t){return t.begin()}))}return t.prototype.maybeState=function(t,e){var i=this.states.get(t);if(i)return e(i);console.warn("no state ",t)},t.prototype.makeState=function(t){var e=t.hooks;return new k({begin:this.makeBegin(e.begin),update:this.makeUpdate(e.update),end:this.makeEnd(e.end,t.next)},t.ticks,t.easing)},t.prototype.makeBegin=function(t){return function(){null==t||t()}},t.prototype.makeUpdate=function(t){return function(e,i){null==t||t(e,i)}},t.prototype.makeEnd=function(t,e){var i=this;return function(){null==t||t(),e&&i.transition(e)}},t.prototype.transition=function(t){this.maybeState(this.current,(function(t){t.cut()})),this.current=t,this.maybeState(this.current,(function(t){t.begin()}))},t.prototype.update=function(){this.maybeState(this.current,(function(t){t.update()}))},t}(),P=function(){function t(t){t&&(this.sf=t)}return Object.defineProperty(t.prototype,"sf",{set:function(t){this.sfi?this.sfi[0]=t:this.sfi=[t,h.zero]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"si",{set:function(t){var e=h.make(Math.floor(3*t),0);this.sfi&&(this.sfi[1]=e)},enumerable:!1,configurable:!0}),t}();var j=function(){return(j=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var S in e=arguments[i])Object.prototype.hasOwnProperty.call(e,S)&&(t[S]=e[S]);return t}).apply(this,arguments)},R={w:13,h:18},M={rest:j({x:0,y:0},R),turn:j({x:0,y:18},R),pace:j({x:0,y:36},R),stick:j({x:0,y:54},R),wlift:j({x:0,y:72},R),dash:j({x:0,y:90},R),jump:j({x:0,y:108},R)};const A=function(){function t(t,e){this.psfi=new P,this.gravityTicks=15,this.dynamic=t,this.maxHeight=e,this.machine=new O({liftAccel:{hooks:{begin:this.liftAccelBegin.bind(this),update:this.liftAccelUpdate.bind(this)},next:"liftDeccel",ticks:1},liftDeccel:{hooks:{update:this.liftDeccelUpdate.bind(this)},next:"liftHang",ticks:b},liftHang:{hooks:{begin:this.liftHangBegin.bind(this)},next:"landAccel",ticks:5},landAccel:{hooks:{begin:this.landAccelBegin.bind(this),update:this.landAccelUpdate.bind(this)},next:"gravity",ticks:1},rest:{hooks:{begin:this.restBegin.bind(this),update:this.restUpdate.bind(this)}},coyote:{hooks:{},ticks:5,next:"gravity"},gravity:{hooks:{begin:this.gravityBegin.bind(this),update:this.gravityUpdate.bind(this)}}},"rest")}return Object.defineProperty(t.prototype,"sfi",{get:function(){return this.psfi.sfi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vMax",{get:function(){var t=this.machine.maybeState("liftAccel",(function(t){return t.safeTicks})),e=this.machine.maybeState("liftDeccel",(function(t){return t.safeTicks}));return 2*this.maxHeight/(t+e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"landVMax",{get:function(){var t=this.machine.maybeState("landAccel",(function(t){return t.safeTicks}));return 2*this.maxHeight/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fallVMax",{get:function(){return this.maxHeight/this.gravityTicks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groundedGrace",{get:function(){return this.dynamic.grounded},enumerable:!1,configurable:!0}),t.prototype.request=function(){"rest"!==this.machine.current&&"coyote"!==this.machine.current||this.machine.transition("liftAccel")},t.prototype.cutRequest=function(){"liftAccel"!==this.machine.current&&"liftDeccel"!==this.machine.current||this.machine.transition("landAccel")},t.prototype.gravityUpdate=function(t){if(this.dynamic.grounded)this.machine.transition("rest");else{var e=Math.min(t,this.gravityTicks)/this.gravityTicks;this.dynamic.dy=e*this.fallVMax,this.dynamic.entity.dimExpand=this.dynamic.entity.dimExpand.ipol(t%60/60,h.one)}},t.prototype.restUpdate=function(t){this.dynamic.grounded||this.machine.transition("coyote")},t.prototype.liftAccelBegin=function(){this.psfi.sf=f.make(M.jump)},t.prototype.landAccelBegin=function(){},t.prototype.gravityBegin=function(){},t.prototype.restBegin=function(){this.dynamic.dy=0,this.psfi.sfi=void 0,this.dynamic.entity.dimExpand=h.one},t.prototype.liftHangBegin=function(){this.dynamic.dy=0},t.prototype.liftDeccelUpdate=function(e){this.dynamic.dy=(e-1)*this.vMax,this.dynamic.entity.dimExpand=h.one.ipol(Math.min(1,e+.5),t.liftDimExpand)},t.prototype.liftAccelUpdate=function(t){this.dynamic.dy=-t*this.vMax},t.prototype.landAccelUpdate=function(t){this.dynamic.grounded&&this.machine.transition("rest"),this.dynamic.dy=0},t.prototype.update=function(){this.machine.update()},t.liftDimExpand=h.make(.7,1.3),t}();var L=[1,2,3,4],U=function(){return(t=L)[Math.floor(Math.random()*t.length)];var t};const D=function(){function t(t,e){var i=this;this.Accel=new k({begin:this.accelBegin.bind(this),update:this.onAccel.bind(this),end:function(){return i.Pace.begin()}},g),this.Pace=new k({begin:this.paceBegin.bind(this),update:this.onPace.bind(this)}),this.Rest=new k({begin:this.restBegin.bind(this)}),this.maxAccelX=16,this.sfx=t,this.direction=e,this.dx=0,this.Rest.begin()}return Object.defineProperty(t.prototype,"sf",{set:function(t){this.sfi?this.sfi[0]=t:this.sfi=[t,h.zero]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"si",{set:function(t){var e=h.make(Math.floor(3*t),0);this.sfi&&(this.sfi[1]=e,0===t?this.sfx.now(U()):this.sfx.request(U()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vMax",{get:function(){return 2*this.maxAccelX/this.Accel.safeTicks},enumerable:!1,configurable:!0}),t.prototype.request=function(){var t=this;this.Rest.cut((function(){t.Accel.begin()}))},t.prototype.cool=function(){var t=this;this.Accel.cut((function(){t.Rest.begin()})),this.Pace.cut((function(){t.Rest.begin()}))},t.prototype.accelBegin=function(){this.sf=f.make(M.turn)},t.prototype.paceBegin=function(){this.sf=f.make(M.pace)},t.prototype.restBegin=function(){this.dx=0,this.sfi=void 0},t.prototype.onAccel=function(t){this.dx=t*this.direction*this.vMax,this.si=t},t.prototype.onPace=function(t){this.dx=this.direction*this.vMax,this.si=t%b/b},t.prototype.update=function(){this.Accel.update(),this.Pace.update(),this.Rest.update()},t}(),T=function(){function t(t,e,i){this.psfi=new P,this.maxFall=i,this.dynamic=t,this.direction=e,this.machine=new O({liftAccelXY:{hooks:{begin:this.liftAccelBegin.bind(this),end:this.liftAccelEnd.bind(this),update:this.liftAccelXYUpdate.bind(this)},ticks:g,next:"liftAccelY"},liftAccelY:{hooks:{update:this.liftAccelYUpdate.bind(this)},ticks:10,next:"rest"},stick:{hooks:{end:this.stickEnd.bind(this),begin:this.stickBegin.bind(this),update:this.stickUpdate.bind(this)}},stickLift:{hooks:{begin:this.stickBegin.bind(this),end:this.stickEnd.bind(this),update:this.stickLiftUpdate.bind(this)}},quickStickThenRest:{hooks:{begin:this.stickBegin.bind(this),end:this.stickEnd.bind(this),update:this.quickStickThenRestUpdate.bind(this)},ticks:b,next:"rest"},rest:{hooks:{update:this.restUpdate.bind(this)}},nowall:{hooks:{update:this.nowallUpdate.bind(this)}}},"nowall")}return Object.defineProperty(t.prototype,"sfi",{get:function(){return this.psfi.sfi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"liftVMax",{get:function(){return 32/this.machine.maybeState("liftAccelXY",(function(t){return t.safeTicks}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stickVMax",{get:function(){return this.maxFall/b},enumerable:!1,configurable:!0}),t.prototype.upRequest=function(){["rest","stickLift","stick","quickStickThenRest"].includes(this.machine.current)&&this.dynamic.walled(this.direction)&&(this.dynamic.grounded||this.machine.transition("liftAccelXY"))},t.prototype.request=function(){"rest"===this.machine.current&&this.dynamic.walled(this.direction)&&(this.dynamic.grounded||this.machine.transition("stickLift"))},t.prototype.cool=function(){"stick"!==this.machine.current&&"stickLift"!==this.machine.current||this.machine.transition("rest")},t.prototype.stickBegin=function(){this.psfi.sf=f.make(M.stick)},t.prototype.stickEnd=function(){this.psfi.sfi=void 0},t.prototype.liftAccelBegin=function(){this.psfi.sf=f.make(M.wlift)},t.prototype.liftAccelEnd=function(){this.psfi.sfi=void 0},t.prototype.liftAccelXYUpdate=function(t){this.dynamic.dx=t*this.direction*-1*this.liftVMax*.8,this.dynamic.dy=-t*this.liftVMax},t.prototype.liftAccelYUpdate=function(t){this.dynamic.dy=(t-1)*this.liftVMax},t.prototype.stickLiftUpdate=function(t){this.dynamic.dy<=0?this.dynamic.dy*=1.1:this.machine.transition("stick")},t.prototype.stickUpdate=function(){this.dynamic.walled(this.direction)||this.machine.transition("nowall"),this.dynamic.dy=this.stickVMax},t.prototype.quickStickThenRestUpdate=function(){this.dynamic.dy<=0?this.dynamic.dy*=1.1:this.dynamic.dy=this.stickVMax},t.prototype.nowallUpdate=function(){this.dynamic.walled(this.direction)&&this.machine.transition("quickStickThenRest")},t.prototype.restUpdate=function(){this.dynamic.walled(this.direction)||this.machine.transition("nowall")},t.prototype.update=function(){this.machine.update()},t}(),_=function(){function t(t){this.psfi=new P,this.maxDJump=1,this.dJump=this.maxDJump,this.dynamic=t,this.xDirection=0,this.yDirection=0,this.machine=new O({dashInput:{hooks:{update:this.dashInputUpdate.bind(this)},next:"dash",ticks:5},dash:{hooks:{begin:this.dashBegin.bind(this),update:this.dashUpdate.bind(this)},next:"dashCool",ticks:g,easing:w.easeInOutQuad},dashCool:{hooks:{update:this.dashCoolUpdate.bind(this)},next:"rest",ticks:g},rest:{hooks:{begin:this.restBegin.bind(this),update:this.restUpdate.bind(this)}}},"rest")}return Object.defineProperty(t.prototype,"sfi",{get:function(){return this.psfi.sfi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxDashV",{get:function(){var e=this.machine.maybeState("dash",(function(t){return t.safeTicks}));return 2*t.distance/e},enumerable:!1,configurable:!0}),t.prototype.xRequest=function(t){"dashInput"===this.machine.current&&(this.xDirection=t)},t.prototype.yRequest=function(t){"dashInput"===this.machine.current&&(this.yDirection=t)},t.prototype.request=function(){"rest"===this.machine.current&&this.dJump>0&&this.machine.transition("dashInput")},t.prototype.restBegin=function(){this.xDirection=0,this.yDirection=0,this.psfi.sfi=void 0},t.prototype.restUpdate=function(){(this.dynamic.grounded||this.dynamic.wallGrounded)&&(this.dJump=this.maxDJump)},t.prototype.dashBegin=function(){this.dJump--,this.psfi.sf=f.make(M.dash)},t.prototype.dashInputUpdate=function(t){this.dynamic.dx=(1-t)*this.xDirection,this.dynamic.dy=(1-t)*this.yDirection},t.prototype.dashUpdate=function(t){this.dynamic.dx=t*this.xDirection*this.maxDashV*.5,this.dynamic.dy=t*this.yDirection*this.maxDashV*.5},t.prototype.dashCoolUpdate=function(t){this.dynamic.dx=(1-t)*this.xDirection*this.maxDashV*.5,this.dynamic.dy=(1-t)*this.yDirection*this.maxDashV*.5},t.prototype.update=function(){this.machine.update()},t.distance=64,t}(),q=function(){function t(){this.icool=0,this.delay=g}return t.prototype.now=function(t){this.icool<5&&(this.sfxNow=t)},t.prototype.request=function(t){this.icool<=0&&(this.icool=this.delay+5*Math.random(),this.sfx=t)},t.prototype.update=function(){this.icool>0&&this.icool--,this.sfx&&(this.sfx=void 0),this.icool<=0&&this.sfxNow&&(this.sfx=this.sfxNow,this.sfxNow=void 0)},t}();var B=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const E=function(t){function e(e,i){var n=t.call(this,e,new y(i))||this;return n.pause=!1,n.restI=0,n.psfi=new P(f.make(M.rest)),n.runSfx=new q,n.runLeft=new D(n.runSfx,-1),n.runRight=new D(n.runSfx,1),n.jump=new A(n.dynamic,32),n.slideRight=new T(n.dynamic,1,6.4),n.slideLeft=new T(n.dynamic,-1,6.4),n.dash=new _(n.dynamic),n}return B(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this.entity.ahitbox.xy.sub(p)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this.entity.ahitbox.origin},enumerable:!1,configurable:!0}),e.prototype.update=function(){var e=this.input.btn(S.Left),i=this.input.btn(S.Right),n=this.input.btn(S.Up),r=this.input.btn(S.Down),o=this.input.btn(S.X),s=this.input.btn(S.C);e>0?(this.dash.xRequest(-1),this.slideLeft.request(),this.runLeft.request(),o>0&&this.slideRight.upRequest()):e<0&&(this.slideLeft.cool(),this.runLeft.cool()),i>0?(this.dash.xRequest(1),this.slideRight.request(),this.runRight.request(),o>0&&this.slideLeft.upRequest()):i<0&&(this.slideRight.cool(),this.runRight.cool()),o>0?(o<10&&(this.slideLeft.upRequest(),this.slideRight.upRequest()),o<60&&this.jump.request()):o<0||0===o&&this.jump.cutRequest(),s>0&&s<60&&this.dash.request(),n>0&&this.dash.yRequest(-1),r>0&&this.dash.yRequest(1);var a=this.dynamic.grounded&&(this.runLeft.sfx.sfx||this.runRight.sfx.sfx);a&&this.audio.sfx(a),this.psfi.si=this.restI++%b/b,this.entity.sfi=this.dash.sfi||this.slideLeft.sfi||this.slideRight.sfi||this.jump.sfi||this.runLeft.sfi||this.runRight.sfi||this.psfi.sfi,this.runSfx.update(),this.dynamic.dx=this.runLeft.dx+this.runRight.dx,this.jump.update(),this.runLeft.update(),this.runRight.update(),this.slideRight.update(),this.slideLeft.update(),this.dash.update(),this.pause||t.prototype.update.call(this)},e.prototype.render=function(){this.dynamic.render(this.draw)},e.maker={hitbox:f.make({x:0,y:-5,w:8,h:12}),dim:f.make({x:-3,y:-10,w:13,h:18}),char:"@",apply:function(t,i,n,S){return new e(t,new l(i,this.dim,this.hitbox,n,S))}},e}(v),C=function(){function t(){this.segments=[]}return Object.defineProperty(t.prototype,"w",{get:function(){return this.segments.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this.segments.reduce((function(t,e){return Math.max(t,e.length)}),0)},enumerable:!1,configurable:!0}),t.prototype.get=function(t,e,i){return void 0!==i?(this.segments[t]||(this.segments[t]=[]),this.segments[t][e]=i,i):this.segments[t]?this.segments[t][e]:void 0},t}(),G=function(){function t(t,e){this.cellW=t,this.cellH=e,this.data=new C}return Object.defineProperty(t.prototype,"w",{get:function(){return this.data.w*this.cellW},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this.data.h*this.cellH},enumerable:!1,configurable:!0}),t.prototype.get=function(t,e,i){return this.data.get(t,e,i)},t.prototype.collide=function(t){var e=Math.floor(t.left/this.cellW),i=Math.floor(t.top/this.cellH),n=Math.floor(t.right/this.cellW),S=Math.floor(t.bottom/this.cellH);return this.checkRect(e,i,n,S)},t.prototype.checkRect=function(t,e,i,n){for(var S=t;S<=i;S++)for(var r=e;r<=n;r++)if(this.data.get(S,r))return!0;return!1},t.prototype.render=function(t){t.strokeStyle("red");for(var e=0;e<this.data.w;e++)for(var i=0;i<this.data.h;i++)this.data.get(e,i)&&t.stroke(e*this.cellW,i*this.cellH,this.cellW,this.cellH)},t}();var X=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const I=function(t){function e(e){var i=t.call(this,e)||this;return i.grid=new G(8,8),i.checkpoints=[],i}return X(e,t),e.prototype.load=function(t){var e,i=this,n=(e=t,function(t){var i=[];return e.split("\n").forEach((function(e,n){for(var S=0;S<e.length;S++)e[S]&&e[S]===t&&i.push(h.make(S,n))})),i});n("S").forEach((function(t){i.grid.get(t.i,t.j,!0)})),n("@").forEach((function(t){i.checkpoints.push(t.mul(u))}))},e.prototype.update=function(){},e.prototype.render=function(){this.grid.render(this.draw)},e}(a),F=function(){function t(){this.iWillLock=0,this.frustum=f.make({x:0,y:0,w:320,h:160})}return Object.defineProperty(t.prototype,"lockedFrustum",{get:function(){if(this.lock){if(this.willLock){var t=this.frustum.lock(this.lock),e=this.frustum.lock(this.willLock);return t.i(this.iWillLock,e)}return this.frustum.lock(this.lock)}return this.frustum},enumerable:!1,configurable:!0}),t.prototype.endLock=function(){this.iWillLock=0,this.lock=this.willLock,this.willLock=void 0},t.prototype.worldCameraOffset=function(t,e){return h.make(t,e).sub(this.frustum.xy)},t.prototype.update=function(){this.target&&(this.frustum=this.frustum.approach(this.target,.2,2)),this.frustum=this.lockedFrustum},t}(),V=function(){function t(t,e,i){this.camera=t,this.machine=new O({rest:{hooks:{begin:this.restBegin.bind(this)}},transition:{hooks:{begin:e,update:this.transitionUpdate.bind(this),end:i},ticks:g,next:"rest"}},"rest")}return t.prototype.request=function(t){"rest"===this.machine.current&&(this.camera.willLock=t,this.machine.transition("transition"))},t.prototype.restBegin=function(){this.camera.endLock()},t.prototype.transitionUpdate=function(t){this.camera.iWillLock=t},t.prototype.update=function(){this.machine.update()},t}();var Y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const H=function(t){function e(e){var i=t.call(this,e)||this;return i.camera=new F,i.dquad=new d,i.rev=new Map,i.transition=new V(i.camera,i.onTransitionBegin.bind(i),i.onTransitionEnd.bind(i)),i}return Y(e,t),Object.defineProperty(e.prototype,"visible",{get:function(){var t=this.camera.frustum;return this.dquad.check(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeRect",{get:function(){return this.rev.get(this.activeRoom)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerTransitionRoom",{get:function(){return this.dquad.checkPoint(this.playerOrigin)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"willTransitionToRoom",{get:function(){var t=this.playerTransitionRoom;if(t!==this.activeRoom)return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerTarget",{get:function(){return this.activeRect.translate(this.player.target.x,this.player.target.y).xy},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerOrigin",{get:function(){return this.activeRect.translate(this.player.origin.x,this.player.origin.y).xy},enumerable:!1,configurable:!0}),e.prototype.onTransitionBegin=function(){this.player.pause=!0},e.prototype.onTransitionEnd=function(){if(this.willTransitionToRoom){this.player.pause=!1;var t=this.activeRect;this.activeRoom=this.willTransitionToRoom;var e=this.activeRect,i=t.xy.sub(e.xy);this.player.entity.moveX(i.x),this.player.entity.moveY(i.y)}},e.prototype.load=function(t,e){var i=this;(function(t,e){var i={};t.split("\n").forEach((function(t,n){for(var S=0;S<t.length;S++)t[S]&&e[t[S]]&&(i[t[S]]||(i[t[S]]=[]),i[t[S]].push(h.make(S,n)))}));var n=[];for(var S in i){var r=e[S],o=f.fromPoints(i[S]);n.push([r,o])}return n})(t,e).map((function(t){var e=t[0],n=t[1].mul(160,80),S=new I(i.context);S.load(e),i.dquad.add(n,S),i.rev.set(S,n),i.activeRoom=S}));var n=this.activeRoom.checkpoints[0];this.player=E.maker.apply(this.context,(function(t){return i.activeRoom.grid.collide(t)||!i.playerTransitionRoom}),n.x,n.y),this.camera.lock=this.activeRect},e.prototype.update=function(){this.camera.update(),this.player.update(),this.transition.update(),this.camera.target=this.playerTarget;var t=this.willTransitionToRoom;t&&this.transition.request(this.rev.get(t))},e.prototype.worldCameraOffset=function(t,e){var i=this.camera.worldCameraOffset(t,e);this.draw.camera(i.x,i.y)},e.prototype.render=function(){var t=this;this.visible.forEach((function(e){var i=t.rev.get(e);t.worldCameraOffset(i.x,i.y),e.render()})),this.worldCameraOffset(this.activeRect.x,this.activeRect.y),this.player.render()},e}(a);var W={F:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        @                                               SSSSSSS\n     SSSSSSSSSSSSSSSSSS                   SSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\n",B:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",2:"\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\n        @                                               SSSSSSS\n     SSSSSSSSSSSSSSSSSS                   SSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\n",4:"\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\n        @                                               SSSSSSS\n     SSSSSSSSSSSSSSSSSS                   SSSSS         SSSSSSS\nSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS     SSSSSS         SSSSSSS\n"};const J=function(){function t(t){this.interacted=!1,this.audio=t}return t.prototype.request=function(){this.interacted||(this.interacted=!0,this.audio.initAfterUserInteraction())},t}();var z=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const K=function(t){function e(e){var i=t.call(this,e)||this;return i.initAudio=new J(i.audio),i.rooms=new H(e),i.rooms.load("\n        \nBBFFFF\nBBFFFF\n\n",W),i}return z(e,t),e.prototype.update=function(){var t=this.input.btn(S.Left),e=this.input.btn(S.Right),i=this.input.btn(S.Up),n=this.input.btn(S.Down),r=this.input.btn(S.X),o=this.input.btn(S.C);(t>0||e>0||i>0||n>0||r>0||o>0)&&this.initAudio.request(),this.draw.camera(),this.draw.cls(),this.rooms.update()},e.prototype.render=function(){this.rooms.render()},e}(a);function N(){var t,e,i,n,S,r=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*Math.pow(2,(t-128)/12)},s=function(t,e,i){var n,S,r,s,c,h,u=a[t.i[0]],p=t.i[1],f=t.i[3]/32,d=a[t.i[4]],l=t.i[5],y=t.i[8]/32,m=t.i[9],b=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,x=t.i[12]*t.i[12]*4,v=1/x,w=-t.i[13]/16,k=t.i[14],O=i*Math.pow(2,2-t.i[15]),P=new Int32Array(b+g+x),j=0,R=0;for(n=0,S=0;n<b+g+x;n++,S++)S>=0&&(S-=O,c=o(e+(15&(k=k>>8|(255&k)<<4))+t.i[2]-128),h=o(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,n<b?r=n/b:n>=b+g&&(r=(1-(r=(n-b-g)*v))*Math.pow(3,w*r)),s=u(j+=c*Math.pow(r,f))*p,s+=d(R+=h*Math.pow(r,y))*l,m&&(s+=(2*Math.random()-1)*m),P[n]=80*s*r|0;return P},a=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(r){t=r,e=r.endPattern,i=0,n=r.rowLen*r.patternLen*(e+1)*2,S=new Int32Array(n)},this.generate=function(){var o,c,h,u,p,f,d,l,y,m,b,g,x,v,w=new Int32Array(n),k=t.songData[i],O=t.rowLen,P=t.patternLen,j=0,R=0,M=!1,A=[];for(h=0;h<=e;++h)for(d=k.p[h],u=0;u<P;++u){var L=d?k.c[d-1].f[u]:0;L&&(k.i[L-1]=k.c[d-1].f[u+P]||0,L<17&&(A=[]));var U=a[k.i[16]],D=k.i[17]/512,T=Math.pow(2,k.i[18]-9)/O,_=k.i[19],q=k.i[20],B=43.23529*k.i[21]*3.141592/44100,E=1-k.i[22]/255,C=1e-5*k.i[23],G=k.i[24]/32,X=k.i[25]/512,I=6.283184*Math.pow(2,k.i[26]-9)/O,F=k.i[27]/255,V=k.i[28]*O&-2;for(b=(h*P+u)*O,p=0;p<4;++p)if(f=d?k.c[d-1].n[u+p*P]:0){A[f]||(A[f]=s(k,f,O));var Y=A[f];for(c=0,o=2*b;c<Y.length;c++,o+=2)w[o]+=Y[c]}for(c=0;c<O;c++)(m=w[l=2*(b+c)])||M?(g=B,_&&(g*=U(T*l)*D+.5),R+=(g=1.5*Math.sin(g))*(x=E*(m-R)-(j+=g*R)),m=3==q?R:1==q?x:j,C&&(m=(m*=C)<1?m>-1?r(.25*m):-1:1,m/=C),M=(m*=G)*m>1e-5,v=m*(1-(y=Math.sin(I*l)*X+.5)),m*=y):v=0,l>=V&&(v+=w[l-V+1]*F,m+=w[l-V]*F),w[l]=0|v,w[l+1]=0|m,S[l]+=0|v,S[l+1]+=0|m}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,n/2,44100),i=0;i<2;i++)for(var r=e.getChannelData(i),o=i;o<n;o+=2)r[o>>1]=S[o]/65536;return e},this.createWave=function(){var t=44+2*n-8,e=t-36,i=new Uint8Array(44+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,o=44;r<n;++r){var s=S[r];s=s<-32767?-32767:s>32767?32767:s,i[o++]=255&s,i[o++]=s>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),n=new Array(e),r=0;r<2*e;r+=1){var o=i+r;n[r]=t>0&&o<S.length?S[o]/32768:0}return n}}const $=function(){function t(){this.waves={},this.sounds={}}return t.prototype.generate=function(t){var e=this;return t.forEach((function(t,i){var n=new N;n.init(t);var S=function(){if(1===n.generate()){var t=n.createWave().buffer;e.waves[i]=t}else setTimeout(S,0)};S()})),new Promise((function(i){var n=function(){Object.keys(e.waves).length!==t.length?setTimeout(n,100):i(e)};n()}))},t.prototype.initAfterUserInteraction=function(){var t=this;this.ctx=new AudioContext,this.audioMaster=this.ctx.createGain(),this.audioMaster.connect(this.ctx.destination);var e=function(e){i.ctx.decodeAudioData(i.waves[e],(function(i){t.sounds[e]=i}))},i=this;for(var n in this.waves)e(n)},t.prototype.sfx=function(t,e,i,n,S){void 0===e&&(e=.5),void 0===i&&(i=1),void 0===n&&(n=0),void 0===S&&(S=!1);var r=this.sounds[t];if(!r)return null;var o=this.ctx.createBufferSource(),s=this.ctx.createGain(),a=this.ctx.createStereoPanner();return o.buffer=r,o.connect(a),a.connect(s),s.connect(this.audioMaster),o.playbackRate.value=i,o.loop=S,s.gain.value=e,a.pan.value=n,o.start(),{volume:s,sound:o}},t}();var Q=function(t){return{songData:[{i:[0,39,92,0,1,27,97,17,230,59,23,8,17,29,35,3,2,195,6,0,1,2,177,66,160,0,0,9,1],p:[1],c:[{n:[t],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,59]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}};const Z=[Q(100),Q(139),Q(152),Q(156),Q(120)];var tt=function(t){return{songData:[{i:[0,39,92,0,1,27,97,17,230,59,23,8,17,29,35,3,2,195,6,0,1,2,177,66,160,0,0,9,1],p:[1],c:[{n:[t],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,59]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}};const et=[tt(100),tt(139),tt(152),tt(156),tt(120)];var it=function(t){return{songData:[{i:[0,39,92,0,1,27,97,17,230,59,23,8,17,29,35,3,2,195,6,0,1,2,177,66,160,0,0,9,1],p:[1],c:[{n:[t],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,59]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}};const nt=[it(100),it(139),it(152),it(156),it(120)];var St=function(t,e){for(var i=0,n=e.length,S=t.length;i<n;i++,S++)t[S]=e[i];return t};const rt=St(St(St([],Z),et),nt);function ot(i){var n,S=new $;Promise.all([(n=t,new Promise((function(t){var e=new Image;e.src=n,e.onload=function(){return t(e)}}))),S.generate(rt)]).then((function(t){var n=t[0],S=t[1],r=new s(i),a=new e(r.ctx,n),c=new o;c.bind(),c.bindGamepad();var h,u=new K({audio:S,draw:a,input:c});h=function(){u.update(),c.update(),u.render()},Date.now(),function t(){Date.now(),h(),requestAnimationFrame(t)}()}))}})(),kcapeW=n})();