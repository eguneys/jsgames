var Space;(()=>{var t={768:()=>{colors={dark:"#1d2b53",light:"#fff1e8"},tile_colors=["#754665","#ff6e59","#f3ef7d","#ffccaa","#7e2553","#ff004d","#fff1e8"];let t=1/60;ticks={second:1,half:.5,third:20*t,sixth:10*t,lengths:5*t,three:.05,one:1*t}},891:()=>{appr=(t,i,s)=>t<i?Math.min(t+s,i):Math.max(t-s,i),lerp=(t,i,s)=>(1-t)*i+s*t,inters=(t,i)=>!(t[0]>i[0]+i[2]||i[0]>t[0]+t[2]||t[1]>i[1]+i[3]||i[1]>t[1]+t[3])},202:(t,i,s)=>{"use strict";t.exports=s.p+"level.png"},221:(t,i,s)=>{"use strict";t.exports=s.p+"sprites.png"}},i={};function s(e){var h=i[e];if(void 0!==h)return h.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.d=(t,i)=>{for(var e in i)s.o(i,e)&&!s.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var i=s.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var e=i.getElementsByTagName("script");e.length&&(t=e[e.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})();var e={};(()=>{"use strict";function t(){this._btn=new Map;const t=t=>{this._btn.has(t)&&0!==this._btn.get(t)||this._btn.set(t,ticks.one)},i=t=>{this._btn.set(t,-ticks.sixth)};this.btn=t=>this._btn.get(t)||0,this.update=t=>{for(let[i,s]of this._btn){let e=Math.sign(s);0!==s&&(s+=t,Math.sign(s)!==e&&(s=0)),this._btn.set(i,s)}},document.addEventListener("keydown",(i=>{switch(i.key){case"ArrowUp":t("up");break;case"ArrowDown":t("down");break;case"ArrowLeft":t("left");break;case"ArrowRight":t("right");break;case"x":t("x");break;case"c":t("c")}})),document.addEventListener("keyup",(t=>{switch(t.key){case"ArrowUp":i("up");break;case"ArrowDown":i("down");break;case"ArrowLeft":i("left");break;case"ArrowRight":i("right");break;case"c":i("c");break;case"x":i("x")}}))}function i(t,i){let s=document.createElement("canvas"),e=s.getContext("2d");e.imageSmoothingEnabled=!1,s.width=320,s.height=180,t.appendChild(s),this.cls=()=>{e.clearRect(0,0,320,180)},this.ctx=t=>t(e),this.color=t=>{e.fillStyle=t,e.strokeStyle=t},this.fr=(t,i,s,h)=>{t=Math.round(t),i=Math.round(i),e.fillRect(t,i,s,h)},this.r=(t,i,s,h)=>{t=Math.round(t),i=Math.round(i),e.beginPath(),e.rect(t,i,s,h),e.stroke()},this.spr=(t,s,h,o,n,a,r,d)=>{t=Math.round(t),s=Math.round(s),e.save(),e.translate(t,s),r&&(e.translate(n,0),e.scale(-1,1)),e.drawImage(i,h,o,n,a,0,0,n,a),e.restore()}}s.r(e),s.d(e,{default:()=>C}),s(768),s(891);var h=s(221),o=s(202);function n(t){const i=["#ff0000","#c00000","#ffffcc","#0000ff","#ffff00"],s=t=>"#"+t.slice(0,3).map((t=>{return(1===(i=t).toString(16).length?"0":"")+i.toString(16);var i})).join("").toLowerCase();let e=document.createElement("canvas"),h=e.getContext("2d");this.width=t.width/4,this.height=t.height/4,this.res=i.map((t=>[])),e.width=t.width,e.height=t.height,h.drawImage(t,0,0,t.width,t.height);let{data:o}=h.getImageData(0,0,t.width,t.height);for(let e=0;e<t.height;e+=4)for(let h=0;h<t.width;h+=4){let n=t.width*e+h<<2,a=[o[n],o[n+1],o[n+2],o[n+3]],r=i.indexOf(s(a));-1!==r&&this.res[r].push([h/4,e/4])}}function a(t){let i=new Image;return new Promise((s=>{i.onload=function(){s(i)},i.src=t}))}function r(t,i,s,e,h,o=[],n=[]){let a=h.map(((t,h)=>[(i[2]||0)+(s+h)*i[0],(i[3]||0)+e*i[1],i[0],i[1]])),r=0,d=0,c=0,l=0;function g(){return a[l]}this.o_x=()=>d,this.o_y=()=>c,this.is_ok=()=>l<1,this.goto=t=>{l=t,r=0,d=0,c=0},this.update=t=>{r+=t,r>=h[l]&&(l=(l+1)%h.length,r=0),d=lerp(.3,d,o[l]||0),c=lerp(.3,c,n[l]||0)},this.draw=(i,s,e,h)=>{let o=e?-1:1,n=h?-1:1,a=g();t.spr(i+d*o,s+c*n,...a,e,h)}}function d(t,i,s,e){t.solid(i,s,e)}const c=[d,d,function(t,i,s){t.player(i,s)},function(t,i,s){t.sword(i,s)},function(t,i,s){t.enemy(i,s)}];function l(t,i,s,e){let h=s*t;this.data=new Map,this.all=()=>this.data.values(),this.collide=(t,i,s,e,h=0,o=0)=>{for(let n=0;n<s;n++)for(let s=0;s<e;s++)if(this.get(h+t+n,o+i+s))return!0;return!1},this.get=(s,e,o)=>{let[n,a]=[Math.floor(s/t),Math.floor(e/i)];return void 0!==o&&this.data.set(a*h+n,o),this.data.get(a*h+n)},this.draw=h=>{for(let o=0;o<s;o++)for(let s=0;s<e;s++)this.get(o*t,s*i)&&h.draw(o*t,s*i,t,i)}}function g(t,i,s,e,h,o,n){this.x=t,this.y=i,this.ox=s,this.oy=e,this.w=h,this.h=o,this.cbox=[this.x+this.ox,this.y+this.oy,this.w,this.h],this.cbox_pre=[0,0,0,0],this.dx=0,this.dy=0,this.remx=0,this.remy=0,this._get_body=()=>{this.cbox_pre[0]=this.cbox[0],this.cbox_pre[1]=this.cbox[1],this.cbox_pre[2]=this.cbox[2],this.cbox_pre[3]=this.cbox[3],this.cbox[0]=this.x+this.ox,this.cbox[1]=this.y+this.oy,this.cbox[2]=this.w,this.cbox[3]=this.h},this.manual=(t,i)=>{this.x=t,this.y=i,this._get_body()},this.move=t=>{this._get_body(),this.remx+=this.dx*t;let i=Math.floor(this.remx);this._move_x(i),this.remx-=i,this.remy+=this.dy*t,i=Math.floor(this.remy),this._move_y(i),this.remy-=i},this._move_x=t=>{let i=Math.sign(t);for(let s=0;s<Math.abs(t);s++)if(this.x+=i,this._get_body(),n(this))return this.x-=i,this.dx=0,void this._get_body()},this._move_y=t=>{let i=Math.sign(t);for(let s=0;s<Math.abs(t);s++)if(this.y+=i,this._get_body(),n(this))return this.y-=i,this.dy=0,void this._get_body()},this.draw=(t,i)=>{t.color(i),t.fr(this.cbox[0],this.cbox[1],this.cbox[2],this.cbox[3])}}const b=70/ticks.second,f=2*b/ticks.lengths,y=f/2,x=90/ticks.second,p=30/ticks.third,u=p/ticks.lengths,w=16/ticks.second,k=16/ticks.second,m=90/ticks.third,_=60/ticks.third;function v(t){let i=0;this.update=s=>{Math.abs(t.body.dx)>x?t.body.dx=appr(t.body.dx,t.move_x*b,y*s):t.body.dx=appr(t.body.dx,t.move_x*b,f*s),0!==t.move_x&&(t.facing=t.move_x),0!==t.move_y&&i>0&&(i=0,t.body.dx+=w*t.move_x,t.body.dy=-m,t.body.dx+=k,t.body.dy-=k),t.grounded?i=ticks.lengths:(i>0&&(i-=s),t.body.dy=appr(t.body.dy,p,u*s)),t.slashing>0&&(t.body.dx=_*(0===t.sdir[0]&&0===t.sdir[1]?t.facing:t.sdir[0]),t.body.dy=_*t.sdir[1])}}function M(t,i,s){this.is="player";let{input:e}=t;this.update=t=>{let i=0,h=0,o=0;0!==e.btn("left")?i=-1:0!==e.btn("right")&&(i=1),0!==e.btn("up")?h=-1:0!==e.btn("down")&&(h=1),e.btn("x")>0&&e.btn("x")<ticks.sixth&&(o=1),e.btn("c")>0&&e.btn("c")<ticks.sixth&&s.slash(i,h),s.walk(i),s.jump(o)}}function j(t,i,s,e){let h,o,n=ticks.lengths+ticks.three,a=new r(t.g,[21,15,128,26],0,0,[n,n],[1,-1],[-2,0]),d=new r(t.g,[21,15,128,26],2,0,[ticks.sixth/3+.3*ticks.sixth,ticks.sixth/3-.1*ticks.sixth,ticks.second],[12,14,24],[-8,-8,-8]),c=new r(t.g,[21,14,0,25],0,0,[n,n,n],[1,-1,1],[-3,-2,-1]),l=new r(t.g,[21,25],0,0,[n,n,n],[-1,0,1]),g=new r(t.g,[21,25],3,0,[n,1.3*n,n],[3,0,-2]),y=new r(t.g,[21,25],6,0,[.5*-n+n,.5*-n+1.3*n,.5*-n+n],[2,0,-2],[-2,0,-1]),x=new r(t.g,[21,25],10,0,[ticks.sixth]),p=new r(t.g,[21,25],8,0,[ticks.sixth]),u=new r(t.g,[21,25],12,0,[ticks.sixth,30*ticks.second]),w=new r(t.g,[21,25],18,0,[(ticks.sixth+ticks.lengths)/3,(ticks.sixth+ticks.lengths)/3,ticks.third]),k=y,m=a;const _=t=>{o!==t&&(o=t,o.goto(0))},v=t=>{h!==t&&(h=t,h.goto(0))};this.update=t=>{0!==s.slashing?_(d):_(a),s.slashing>0?(console.log(k===w),v(w)):s.grounded?Math.abs(s.body.dx)<f&&0===s.move_x?v(l):Math.abs(s.body.dx)<.5*b?v(g):v(y):s.body.dy<0?v(x):Math.abs(s.body.dy)<.1*b?v(p):v(u),h&&h!==k&&(k=h,h=void 0),o&&o!==m&&(m=o,o=void 0),k.update(t),c.update(t),m.update(t)},this.draw=()=>{k.draw(s.body.x,s.body.y,-1===s.facing),c.draw(s.body.x+s.facing*k.o_x(),s.body.y+k.o_y(),-1===s.facing),s.dslash>=0&&m.draw(10*-s.facing+s.body.x+s.facing*k.o_x(),16+s.body.y+s.facing*k.o_y(),-1===s.facing)}}function S(t){let i,s=[0,0],e=[0,0],h=[130,70,60,40],o=[0,0];this.bounds=(t,s,e,h)=>{i=[t,s,e,h]},this.follow=t=>{e=t,o=[...e]},this.attach=()=>{t.ctx((t=>{t.save(),t.translate(Math.floor(160-s[0]),Math.floor(90-s[1]))}))},this.detach=()=>{t.ctx((t=>{t.restore()}))},this.update=t=>{let n=h[0],a=h[1],r=h[0]+h[2],d=h[1]+h[3],[c,l]=[0,0],[g,b]=this.get_local(...e),[f,y]=this.get_local(...s);if(g<f+(n+r-f)){let t=g-n;t<0&&(c=t)}if(g>f-(n+r-f)){let t=g-r;t>0&&(c=t)}if(b<y+(a+d-y)){let t=b-a;t<0&&(l=t)}if(b>y-(a+d-y)){let t=b-d;t>0&&(l=t)}c+=e[0]-o[0],l+=e[1]-o[1],o[0]=e[0],o[1]=e[1],s[0]=lerp(.5,s[0],s[0]+c),s[1]=lerp(.5,s[1],s[1]+l),i&&(s[0]=Math.min(Math.max(s[0],i[0]+160),i[0]+i[2]-160),s[1]=Math.min(Math.max(s[1],i[1]+90),i[1]+i[3]-90))},this.get_local=(t,i)=>[t-s[0]+160,i-s[1]+90],this.draw=()=>{t.color(colors.light),t.r(...h)}}function A(t){let{g:i,a:s}=t;this.init=t=>{this.camera=new S(i),this.camera.bounds(0,0,4*t.width,4*t.height),this.grid=new l(4,4,t.width,t.height),this.objects=[];for(let i=0;i<t.res.length;i++)for(let s=0;s<t.res[i].length;s++){let[e,h]=t.res[i][s],o=c[i];o?o(this,4*e,4*h,i):console.warn(`notile ${i}`)}},this.is_solid=(t,i,s,e,h,o)=>this.grid.collide(t,i,s,e,h,o),this.get=t=>this.objects.filter((i=>i.is===t)),this.collide_check=(t,i,s,e,h,o,n)=>this.objects.filter((i=>i.is===t&&i.body)).find((t=>inters(t.body.cbox,[i+o,s+n,e,h]))),this.solid=(t,i,s)=>{this.grid.get(t,i,tile_colors[s])},this.player=(i,s)=>{let e=new E(t,this);return this.objects.push(e),e.init(i,s),e},this.sword=(i,s)=>{let e=new P(t,this);return this.objects.push(e),e.init(i,s),e},this.enemy=(i,s)=>{let e=new L(t,this);return this.objects.push(e),e.init(i,s),e},this.remove=t=>{this.objects=this.objects.filter((i=>i!==t))},this.f_collide=t=>!!this.is_solid(...t.cbox),this.update=t=>{this.camera.update(t);for(let i of this.objects)i.update(t);e.update(t)};let e=new r(t.g,[4,4,0,48],0,0,[ticks.second]);this.draw=()=>{this.camera.draw(),this.camera.attach(),this.grid.draw(e);for(let t of this.objects)t.draw();this.camera.detach()}}function E(t,i){let{g:s,a:e}=t,h=new r(t.g,[8,8,320,32],0,0,[ticks.sixth,ticks.sixth]);this.init=(s,e)=>{this.x=s,this.y=e;let h=new O(t,i);h.init(this.x,this.y,new M(t,i,h),new j(t,i,h)),i.objects.push(h),i.camera.follow(h.ctarget)},this.update=t=>{h.update(t)},this.draw=()=>{h.draw(this.x+80,this.y-80)}}function P(t,i){let s=new r(t.g,[8,8,320,32],2,0,[ticks.sixth,ticks.sixth]);this.is="swordspawn";let{g:e,a:h}=t,o=new r(t.g,[16,16,128,48],0,0,[ticks.sixth,ticks.sixth,ticks.sixth,ticks.sixth],[1,-1,0,0],[-2,0,2,0]),n=-1;this.init=(t,s)=>{this.body=new g(t,s-25,0,0,16,16,i.f_collide)},this.req=()=>{n<0&&(n=ticks.second)},this.update=t=>{o.update(t),n>0&&(n=appr(n,0,t),0===n&&i.get("player")[0].sword()),s.update(t)},this.draw=()=>{if(n>0){let t=(ticks.second-n)/ticks.second;t*ticks.second%(2*ticks.lengths)<ticks.lengths&&o.draw(this.body.x,this.body.y-30*t)}else n<0?o.draw(this.body.x,this.body.y):s.draw(this.body.x,this.body.y-30)}}function O(t,i){let{g:s,a:e}=t;this.ctarget=[0,0];const h=()=>{this.ctarget[0]=this.body.cbox[0]+.5*this.body.cbox[2],this.ctarget[1]=this.body.cbox[1]+.5*this.body.cbox[3]};this.init=(t,s,e,o)=>{this.anim=o,this.think=e,this.is=this.think.is,this.body=new g(t,s-25+4,4,4,15,21,i.f_collide),this.actions=new v(this),this.facing=1,this.grounded=!1,this.move_x=0,this.move_y=0,this.slashing=0,this.dslash=-1,h()},this.sword=()=>{this.dslash=1},this.walk=t=>this.move_x=t,this.jump=t=>this.move_y=t,this.slash=(t,i)=>{this.dslash>0&&0===this.slashing&&(this.sdir=[t,i],this.slashing=ticks.sixth+ticks.lengths,this.dslash-=1)},this.update=t=>{h(),this.slashing>0?(this.slashing=appr(this.slashing,0,t),0===this.slashing&&(this.slashing=-ticks.sixth)):this.slashing<0&&(this.slashing=appr(this.slashing,0,t)),this.grounded=i.is_solid(...this.body.cbox,0,1),this.grounded&&this.dslash>=0&&0===this.slashing&&(this.dslash=1),this.think.update(t),this.actions.update(t),this.anim.update(t);let s=i.collide_check("swordspawn",...this.body.cbox,0,0);s&&(i.get("enemy").forEach((t=>t.live())),s.req());let e=i.collide_check("enemy",...this.body.cbox,0,0);e&&(this.body.dx*=.5,this.slashing>0?e.damage():this.dslash>0&&-1===e.t_dying&&(this.body.dx*=-2)),this.body.move(t),this.dead&&i.remove(this)},this.draw=()=>{this.anim.draw()}}function L(t,i){this.is="enemy";let s,e=new r(t.g,[33,19,0,77],0,0,[ticks.half,ticks.half,ticks.half]),h=new r(t.g,[33,19,0,77],3,0,[ticks.second]),{g:o,a:n}=t;this.init=(t,e)=>{this.body=new g(t,e-19+4,4,4,27,15,i.f_collide),s=h,this.t_dying=-1},this.live=()=>{s=e},this.damage=()=>{this.t_dying<0&&(this.t_dying=ticks.half,this.body.dx=16/ticks.half)},this.update=t=>{this.t_dying>0&&(this.t_dying=appr(this.t_dying,0,t),0===this.t_dying&&(s=h)),this.body.dx=appr(this.body.dx,0,t*(16/ticks.half)),this.body.move(t),s.update(t)},this.draw=()=>{s.draw(this.body.x,this.body.y),this.t_dying>0&&this.t_dying/ticks.half%(2*ticks.sixth)<ticks.sixth&&o.fr(...this.body.cbox,colors.light)}}function T(t){let{g:i,a:s}=t;this.room=new A(t),this.init=()=>{this.room.init(s.level)},this.update=t=>{this.room.update(t)},this.draw=()=>{i.cls(),i.color(colors.dark),i.fr(0,0,320,180),this.room.draw()}}function C(s){Promise.all([a(h),a(o).then((t=>new n(t)))]).then((([t,i])=>({sprites:t,level:i}))).then((e=>{let h=new t,o=new T({a:e,g:new i(s,e.sprites),input:h});o.init(),function t(){h.update(1/60),o.update(1/60),o.draw(),requestAnimationFrame(t)}()}))}})(),Space=e})();